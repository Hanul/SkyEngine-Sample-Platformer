SkyEngine.CreateGradient=METHOD({run:e=>{let n,i=e.type,t=e.startX,o=e.startY,c=e.startRadius,a=e.endX,r=e.endY,l=e.endRadius,d=e.colors;return n="radial"===i?SkyEngine.Screen.getCanvasContext().createRadialGradient(t,o,c,a,r,l):SkyEngine.Screen.getCanvasContext().createLinearGradient(t,o,a,r),EACH(d,(e,i)=>{n.addColorStop(i/(d.length-1),e)}),n}}),SkyEngine.Delay=CLASS(e=>{let n=[];e.step=(e=>{for(let i=0;i<n.length;i+=1)n[i].step(e)});return{init:(e,i,t,o)=>{void 0===o&&(o=t,t=0);let c=0,a=(i.resume=RAR(()=>{CHECK_IS_IN({array:n,value:i})!==!0&&n.push(i)}),i.pause=(()=>{REMOVE({array:n,value:i})})),r=i.remove=(()=>{a()});i.step=(e=>{c+=e,c>=t&&(o(),r())})}}}),SkyEngine.E=CLASS({preset:()=>{return E},init:(e,n,i)=>{n.stopDefault=(()=>{i.stopDefault()}),n.stopBubbling=(()=>{i.stopBubbling()}),n.checkIsBubblingStoped=(()=>{return i.checkIsBubblingStoped()}),n.stop=(()=>{i.stop()}),n.getX=(()=>{return(i.getLeft()-WIN_WIDTH()/2)/SkyEngine.Screen.getRatio()}),n.getY=(()=>{return(i.getTop()-WIN_HEIGHT()/2)/SkyEngine.Screen.getRatio()}),n.getKey=(()=>{return i.getKey()}),n.getWheelDelta=(()=>{return i.getWheelDelta()})}}),SkyEngine.Interval=CLASS(e=>{let n=[];e.step=(e=>{for(let i=0;i<n.length;i+=1)n[i].step(e)});return{init:(e,i,t,o)=>{void 0===o&&(o=t,t=0);let c=0,a=0,r=(i.resume=RAR(()=>{CHECK_IS_IN({array:n,value:i})!==!0&&n.push(i)}),i.pause=(()=>{REMOVE({array:n,value:i})})),l=i.remove=(()=>{r()});i.step=(e=>{c+=e,c>=t&&(c-=t,a+=1,o(i,a)===!1&&l())})}}}),SkyEngine.Node=CLASS({init:(e,n,i)=>{let t,o,c,a,r,l,d,g,f,u,S,s,v,h,R,p,E,y,k,m,C,w,x,I,Y,X,D,T,A,P,O,M,H,W,F,N,L,V,_,b,B,U,G,K,q,z,Z,J,j,Q,$,ee,ne,ie,te,oe,ce,ae,re,le,de,ge,fe,ue,Se,se,ve,he,Re,pe,Ee=[],ye=!1,ke=!1,me={},Ce=[],we=[],xe=[],Ie={},Ye={},Xe={},De=0,Te=BROWSER_CONFIG.SkyEngine.maxCollisionWidth,Ae=BROWSER_CONFIG.SkyEngine.maxCollisionHeight,Pe=()=>{if(void 0===le)b=t,B=o,U=t,G=o;else{let e=t*le.getRealScaleX(),n=o*le.getRealScaleY();b=le.getDrawingX()+e*le.getRealCos()-n*le.getRealSin(),B=le.getDrawingY()+e*le.getRealSin()+n*le.getRealCos();let i=a*K,c=r*q;U=b-i*J+c*Z,G=B-i*Z-c*J}},Oe=n.setX=(e=>{t=e,Pe()}),Me=(n.getX=(()=>{return t}),n.setY=(e=>{o=e,Pe()})),He=(n.getY=(()=>{return o}),n.setZIndex=(e=>{void 0===re?c=e:(Je(),c=e,je())})),We=(n.getZIndex=(()=>{return c}),n.setPosition=(e=>{void 0!==e.x&&(t=e.x),void 0!==e.y&&(o=e.y),void 0===e.x&&void 0===e.y||Pe(),void 0!==e.zIndex&&He(e.zIndex)}),n.setCenterX=(e=>{a=e}),n.getCenterX=(()=>{return a}),n.setCenterY=(e=>{r=e}),n.getCenterY=(()=>{return r}),n.setSpeedX=(e=>{u=e,u<w&&(w=void 0),u>T&&(T=void 0)}),n.getSpeedX=(()=>{return u}),n.setSpeedY=(e=>{S=e,S<x&&(x=void 0),S>A&&(A=void 0)}),n.getSpeedY=(()=>{return S}),n.setAccelX=(e=>{p=e}),n.getAccelX=(()=>{return p}),n.setAccelY=(e=>{E=e}),n.getAccelY=(()=>{return E}),n.setMinSpeedX=(e=>{w=e}),n.getMinSpeedX=(()=>{return w}),n.setMinSpeedY=(e=>{x=e}),n.getMinSpeedY=(()=>{return x}),n.setMaxSpeedX=(e=>{T=e}),n.getMaxSpeedX=(()=>{return T}),n.setMaxSpeedY=(e=>{A=e}),n.getMaxSpeedY=(()=>{return A}),n.setToX=(e=>{W=e}),n.getToX=(()=>{return W}),n.setToY=(e=>{F=e}),n.getToY=(()=>{return F}),n.setScaleX=(e=>{l=e,K=void 0===le?l:le.getRealScaleX()*l})),Fe=(n.getScaleX=(()=>{return l}),n.setScaleY=(e=>{d=e,q=void 0===le?e:le.getRealScaleY()*d})),Ne=(n.getScaleY=(()=>{return d}),n.setScale=(e=>{We(e),Fe(e)})),Le=(n.setScalingSpeedX=(e=>{s=e,s<I&&(I=void 0),s>P&&(P=void 0)}),n.getScalingSpeedX=(()=>{return s}),n.setScalingSpeedY=(e=>{v=e,v<Y&&(Y=void 0),v>O&&(O=void 0)}),n.getScalingSpeedY=(()=>{return v}),n.setScalingSpeed=(e=>{s=e,v=e})),Ve=(n.setScalingAccelX=(e=>{y=e}),n.getScalingAccelX=(()=>{return y}),n.setScalingAccelY=(e=>{k=e}),n.getScalingAccelY=(()=>{return k}),n.setScalingAccel=(e=>{y=e,k=e})),_e=(n.setMinScalingSpeedX=(e=>{I=e}),n.getMinScalingSpeedX=(()=>{return I}),n.setMinScalingSpeedY=(e=>{Y=e}),n.getMinScalingSpeedY=(()=>{return Y}),n.setMinScalingSpeed=(e=>{I=e,Y=e}),n.setMaxScalingSpeedX=(e=>{P=e}),n.getMaxScalingSpeedX=(()=>{return P}),n.setMaxScalingSpeedY=(e=>{O=e}),n.getMaxScalingSpeedY=(()=>{return O}),n.setMaxScalingSpeed=(e=>{P=e,O=e}),n.setToScaleX=(e=>{N=e}),n.getToScaleX=(()=>{return N}),n.setToScaleY=(e=>{L=e}),n.getToScaleY=(()=>{return L}),n.setToScale=(e=>{N=e,L=e})),be=n.setAngle=(e=>{g=e,z=void 0===le?g*Math.PI/180:le.getRealRadian()+g*Math.PI/180,Z=Math.sin(z),J=Math.cos(z)}),Be=(n.getAngle=(()=>{return g}),n.setRotationSpeed=(e=>{h=e,h<X&&(X=void 0),h>M&&(M=void 0)}),n.getRotationSpeed=(()=>{return h}),n.setRotationAccel=(e=>{m=e}),n.getRotationAccel=(()=>{return m}),n.setMinRotationSpeed=(e=>{X=e}),n.getMinRotationSpeed=(()=>{return X}),n.setMaxRotationSpeed=(e=>{M=e}),n.getMaxRotationSpeed=(()=>{return M}),n.setToAngle=(e=>{V=e}),n.getToAngle=(()=>{return V}),n.setAlpha=(e=>{f=e}),n.getAlpha=(()=>{return f}),n.setFadingSpeed=(e=>{R=e,R<D&&(D=void 0),R>H&&(H=void 0)}),n.getFadingSpeed=(()=>{return R}),n.setFadingAccel=(e=>{C=e}),n.getFadingAccel=(()=>{return C}),n.setMinFadingSpeed=(e=>{D=e}),n.getMinFadingSpeed=(()=>{return D}),n.setMaxFadingSpeed=(e=>{H=e}),n.getMaxFadingSpeed=(()=>{return H}),n.setToAlpha=(e=>{_=e}),n.getToAlpha=(()=>{return _}),n.getDrawingX=(()=>{return U}),n.getDrawingY=(()=>{return G}),n.getRealX=(()=>{return b}),n.getRealY=(()=>{return B}),n.getRealScaleX=(()=>{return K}),n.getRealScaleY=(()=>{return q}),n.getRealRadian=(()=>{return z}),n.getRealSin=(()=>{return Z}),n.getRealCos=(()=>{return J}),n.getBeforeX=(()=>{return j}),n.getBeforeY=(()=>{return Q}),()=>{be(g),We(l),Fe(d),Pe()});void 0!==i&&(t=i.x,o=i.y,a=i.centerX,r=i.centerY,c=i.zIndex,void 0!==i.scale&&Ne(i.scale),void 0!==i.scaleX&&(l=i.scaleX),void 0!==i.scaleY&&(d=i.scaleY),g=i.angle,f=i.alpha,u=i.speedX,S=i.speedY,void 0!==i.scalingSpeed&&Le(i.scalingSpeed),void 0!==i.scalingSpeedX&&(s=i.scalingSpeedX),void 0!==i.scalingSpeedY&&(v=i.scalingSpeedY),h=i.rotationSpeed,R=i.fadingSpeed,p=i.accelX,E=i.accelY,void 0!==i.scalingAccel&&Ve(i.scalingAccel),void 0!==i.scalingAccelX&&(y=i.scalingAccelX),void 0!==i.scalingAccelY&&(k=i.scalingAccelY),m=i.rotationAccel,C=i.fadingAccel,w=i.minSpeedX,x=i.minSpeedY,void 0!==i.minScaleSpeed&&setMinScaleSpeed(i.minScaleSpeed),void 0!==i.minScaleSpeedX&&(minScaleSpeedX=i.minScaleSpeedX),void 0!==i.minScaleSpeedY&&(minScaleSpeedY=i.minScaleSpeedY),X=i.minRotationSpeed,D=i.minFadingSpeed,T=i.maxSpeedX,A=i.maxSpeedY,void 0!==i.maxScaleSpeed&&setMaxScaleSpeed(i.maxScaleSpeed),void 0!==i.maxScaleSpeedX&&(maxScaleSpeedX=i.maxScaleSpeedX),void 0!==i.maxScaleSpeedY&&(maxScaleSpeedY=i.maxScaleSpeedY),M=i.maxRotationSpeed,H=i.maxFadingSpeed,W=i.toX,F=i.toY,void 0!==i.toScale&&_e(i.toScale),void 0!==i.toScaleX&&(N=i.toScaleX),void 0!==i.toScaleY&&(L=i.toScaleY),V=i.toAngle,_=i.toAlpha,void 0!==i.isHiding&&(ye=i.isHiding),de=i.filter,ge=i.blendMode,fe=i.isToCheckCollision,Re=i.onDisplayResize),void 0===t&&(t=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===r&&(r=0),void 0===c&&(c=0),void 0===u&&(u=0),void 0===S&&(S=0),void 0===p&&(p=0),void 0===E&&(E=0),void 0===l&&(l=1),void 0===d&&(d=1),void 0===s&&(s=0),void 0===v&&(v=0),void 0===y&&(y=0),void 0===k&&(k=0),void 0===g&&(g=0),void 0===h&&(h=0),void 0===m&&(m=0),void 0===f&&(f=1),void 0===R&&(R=0),void 0===C&&(C=0),void 0!==Re&&(pe=EVENT("resize",RAR(()=>{let e=Re(WIN_WIDTH(),WIN_HEIGHT());void 0!==e.x&&Oe(e.x),void 0!==e.y&&Me(e.y),void 0!==e.scaleX&&We(e.scaleX),void 0!==e.scaleY&&Fe(e.scaleY),void 0!==e.width&&void 0!==n.setWidth&&n.setWidth(e.width),void 0!==e.height&&void 0!==n.setHeight&&n.setHeight(e.height)}))),SkyEngine.Screen!==n&&SkyEngine.Screen.registerNode(n);let Ue=(n.setFilter=(e=>{de=e}),n.getFilter=(()=>{return de}),n.removeFilter=(()=>{de=void 0}),n.setBlendMode=(e=>{ge=e}),n.getBlendMode=(()=>{return ge}),n.removeBlendMode=(()=>{ge=void 0}),n.moveLeft=((e,n)=>{CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(u=-e.speed),p=void 0===e.accel?0:-e.accel,T=0,w=void 0!==e.maxSpeed?-e.maxSpeed:void 0,void 0!==e.toX&&(W=e.toX,ee=n)):(p=0,u=w=-e)})),Ge=(n.stopLeft=(e=>{void 0!==e?(p=e,T=0):u<0&&(p<0&&(p=0),u=0)}),n.moveRight=((e,n)=>{CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(u=e.speed),p=void 0===e.accel?0:e.accel,w=0,T=void 0!==e.maxSpeed?e.maxSpeed:void 0,void 0!==e.toX&&(W=e.toX,ee=n)):(p=0,u=T=e)})),Ke=(n.stopRight=(e=>{void 0!==e?(p=-e,w=0):u>0&&(p>0&&(p=0),u=0)}),n.moveUp=((e,n)=>{CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(S=-e.speed),E=void 0===e.accel?0:-e.accel,A=0,x=void 0!==e.maxSpeed?-e.maxSpeed:void 0,void 0!==e.toY&&(F=e.toY,ne=n)):(E=0,S=x=-e)})),qe=(n.stopUp=(e=>{void 0!==e?(E=e,A=0):S<0&&(E<0&&(E=0),S=0)}),n.moveDown=((e,n)=>{CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(S=e.speed),E=void 0===e.accel?0:e.accel,x=0,A=void 0!==e.maxSpeed?e.maxSpeed:void 0,void 0!==e.toY&&(F=e.toY,ne=n)):(E=0,S=A=e)})),ze=(n.stopDown=(e=>{void 0!==e?(E=-e,x=0):S>0&&(E>0&&(E=0),S=0)}),n.moveTo=((e,n)=>{if(void 0===e.y)e.toX=e.x,delete e.x,e.toX<t?Ue(e,n):Ge(e,n);else if(void 0===e.x)e.toY=e.y,delete e.y,e.toY<o?Ke(e,n):qe(e,n);else{W=e.x,F=e.y;let i=W-t,c=F-o,a=Math.sqrt(i*i+c*c);void 0!==e.speed&&(u=e.speed*i/a,S=e.speed*c/a),void 0!==e.accel&&(p=e.accel*i/a,E=e.accel*c/a),void 0!==e.maxSpeed&&(W<t?w=-e.maxSpeed*i/a:T=e.maxSpeed*i/a,F<o?x=-e.maxSpeed*c/a:A=e.maxSpeed*c/a),$=n}}),n.scaleTo=((e,n)=>{let i=e.speed,t=e.accel,o=(e.minSpeed,e.maxSpeed);void 0===e.y?(N=e.x,N<l?(void 0!==i&&(s=-i),void 0!==t&&(y=-t),void 0!==o&&(I=-o)):(void 0!==i&&(s=i),void 0!==t&&(y=t),void 0!==o&&(P=o)),te=n):void 0===e.x?(L=e.y,L<d?(void 0!==i&&(v=-i),void 0!==t&&(k=-t),void 0!==o&&(Y=-o)):(void 0!==i&&(v=i),void 0!==t&&(k=t),void 0!==o&&(O=o)),oe=n):(N=e.x,N<l?(void 0!==i&&(s=-i),void 0!==t&&(y=-t),void 0!==o&&(I=-o)):(void 0!==i&&(s=i),void 0!==t&&(y=t),void 0!==o&&(P=o)),L=e.y,L<d?(void 0!==i&&(v=-i),void 0!==t&&(k=-t),void 0!==o&&(Y=-o)):(void 0!==i&&(v=i),void 0!==t&&(k=t),void 0!==o&&(O=o)),ie=n)}),n.stuckLeft=(()=>{ue=!0}),n.unstuckLeft=(()=>{ue=!1}),n.stuckRight=(()=>{Se=!0}),n.unstuckRight=(()=>{Se=!1}),n.stuckUp=(()=>{se=!0}),n.unstuckUp=(()=>{se=!1}),n.stuckDown=(()=>{ve=!0}),n.unstuckDown=(()=>{ve=!1}),n.rotate=(e=>{CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(h=e.speed),void 0!==e.accel&&(m=e.accel),void 0!==e.minSpeed&&(X=e.minSpeed),void 0!==e.maxSpeed&&(M=e.maxSpeed)):h=e}),n.stopRotation=(e=>{void 0!==e?(m=-e,e>0?X=0:e<0&&(M=0)):h>0&&(h=0)}),n.rotateTo=((e,n)=>{V=e.toAngle,void 0!==e.speed&&(h=e.speed),void 0!==e.accel&&(m=e.accel),void 0!==e.minSpeed&&(X=e.minSpeed),void 0!==e.maxSpeed&&(M=e.maxSpeed),ce=n}),n.flipX=(()=>{l=-l}),n.flipY=(()=>{d=-d}),n.fadeIn=((e,n)=>{1===f&&(f=0),_=1,void 0===e?R=2:CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(R=e.speed),void 0!==e.accel&&(C=e.accel),void 0!==e.maxSpeed&&(H=e.maxSpeed)):isNaN(e)===!0?(n=e,R=2):R=e,ae=n}),n.fadeOut=((e,n)=>{_=0,void 0===e?R=-2:CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(R=-e.speed),void 0!==e.accel&&(C=-e.accel),void 0!==e.maxSpeed&&(D=-e.maxSpeed)):isNaN(e)===!0?(n=e,R=-2):R=-e,ae=n}),n.stopFading=(e=>{void 0!==e?(C=-e,e>0?D=0:e<0&&(H=0)):R>0&&(R=0)}),n.fadeTo=((e,n)=>{_=e.toAlpha,void 0!==e.speed&&(R=e.speed),void 0!==e.accel&&(C=e.accel),void 0!==e.minSpeed&&(D=e.minSpeed),void 0!==e.maxSpeed&&(H=e.maxSpeed),ae=n}),n.hide=(()=>{ye=!0,void 0!==he&&he.hide()}),n.show=(()=>{ye=!1,void 0!==he&&he.show()}),n.checkIsHiding=(()=>{return ye}),n.checkIsShowing=(()=>{return ye!==!0}),n.getChildren=(()=>{return Ee}),n.getParent=(()=>{return re}),n.setTarget=(e=>{if(le=e,ke!==!0&&void 0!==le){Be();for(let e=0;e<we.length;e+=1)we[e].setTarget(n);for(let e=0;e<Ce.length;e+=1)Ce[e].setTarget(n);for(let e=0;e<Ee.length;e+=1)Ee[e].setTarget(n)}})),Ze=n.setParent=(e=>{re=e,ze(re)}),Je=()=>{let e=re.getChildren(),i=0,t=e.length-1,o=0;for(;i<=t;){let a=Math.ceil((i+t)/2),r=e[a];if(r.getZIndex()<c)i=a+1;else{if(!(r.getZIndex()>c)){for(;;){if(e[a-o]===n){e.splice(a-o,1);break}if(o>0&&e[a+o]===n){e.splice(a+o,1);break}if(e[a-o].getZIndex()!==c&&e[a+o].getZIndex()!==c)break;o+=1}break}t=a-1}}},je=()=>{let e=re.getChildren(),i=0,t=e.length;for(;i<t;){let n=i+t>>>1;e[n].getZIndex()<=c?i=n+1:t=n}e.splice(i,0,n)},Qe=(n.appendTo=(e=>{return void 0!==re&&Je(),Ze(e),je(),n}),n.append=(e=>{e.appendTo(n)}),n.empty=(()=>{for(let e=0;e<Ee.length;e+=1){let n=Ee[e];n.setParent(void 0),n.remove()}Ee=[]}));n.remove=(()=>{en("remove"),Qe(),Ee=void 0,void 0!==re&&(Je(),Ze(void 0)),SkyEngine.Screen!==n&&SkyEngine.Screen.unregisterNode(n),me=void 0;for(let e=0;e<we.length;e+=1)we[e].remove();we=void 0;for(let e=0;e<Ce.length;e+=1)Ce[e].remove();Ce=void 0,xe=void 0,Ie=void 0,Ye=void 0,Xe=void 0,void 0!==he&&he.remove(),ke=!0,void 0!==pe&&(pe.remove(),pe=void 0)}),n.checkIsRemoved=(()=>{return ke}),n.addDom=(e=>{void 0===he&&(he=DIV({style:{position:"fixed",left:-999999,top:-999999}}).appendTo(BODY)),he.append(e)});e.getDomWrapper=(()=>{return he});let $e=(n.getDomWrapper=(()=>{return void 0===he&&(he=DIV({style:{position:"fixed",left:-999999,top:-999999}}).appendTo(BODY)),he}),n.addDomStyle=(e=>{void 0===he&&(he=DIV({style:{position:"fixed",left:-999999,top:-999999}}).appendTo(BODY)),he.addStyle(e)}),n.removeAllDoms=(()=>{void 0!==he&&he.empty()}),n.on=((e,i)=>{ke===!0?"remove"===e&&i(EMPTY_E(),n):(void 0===me[e]&&(me[e]=[]),me[e].push(i))}),n.checkIsEventExists=(e=>{return void 0!==me[e]}),n.off=((e,n)=>{ke!==!0&&void 0!==me[e]&&(void 0!==n&&REMOVE({array:me[e],value:n}),void 0!==n&&0!==me[e].length||delete me[e])})),en=n.fireEvent=(e=>{let i,t;CHECK_IS_DATA(e)!==!0?i=e:(i=e.eventName,t=e.e);let o=me[i];if(void 0!==o)for(let c=0;c<o.length;c+=1)o[c](void 0===t?EMPTY_E():t,n)}),nn=(n.onMeet=((e,n)=>{xe.push(e),void 0===Ye[e.id]&&(Ye[e.id]=[]),Ye[e.id].push(n),on()}),n.offMeet=((e,n)=>{void 0===n?delete Ye[e.id]:REMOVE({array:Ye[e.id],value:n})}),n.runMeetHandlers=((e,n)=>{let i=Ye[e.id];if(void 0!==i)for(let t=0;t<i.length;t+=1)i[t](n)})),tn=(n.onPart=((e,n)=>{xe.push(e),void 0===Xe[e.id]&&(Xe[e.id]=[]),Xe[e.id].push(n)}),n.offPart=((e,n)=>{void 0===n?delete Xe[e.id]:REMOVE({array:Xe[e.id],value:n})}),n.runPartHandlers=((e,n)=>{let i=Xe[e.id];if(void 0!==i)for(let t=0;t<i.length;t+=1)i[t](n)})),on=(n.addTouchArea=(e=>{we.push(e),e.setTarget(n),e.on("remove",()=>{REMOVE({array:we,value:e})})}),n.getTouchAreas=(()=>{return we}),n.getTouchArea=(()=>{return we[0]}),n.addCollider=(e=>{Ce.push(e),e.setTarget(n),e.on("remove",()=>{REMOVE({array:Ce,value:e})})}),n.getColliders=(()=>{return Ce}),n.getCollider=(()=>{return Ce[0]}),n.checkPoint=((e,n)=>{for(let i=0;i<Ee.length;i+=1)if(Ee[i].checkPoint(e,n)===!0)return!0;return!1}),n.checkArea=(e=>{for(let n=0;n<Ee.length;n+=1){let i=Ee[n];if(i.checkArea(e)===!0||e.checkArea(i)===!0)return!0}return!1}),n.checkTouch=((e,i)=>{if(ke===!0||n.checkIsHiding()===!0)return!1;for(let t=0;t<we.length;t+=1)if(we[t].checkPoint(e,i)===!0)return!0;for(let t=0;t<Ee.length;t+=1)if(Ee[t].checkTouch(e,i)===!0)return!0;return!1}),n.checkOneSideCollision=(e=>{if(ke===!0||n.checkIsHiding()===!0)return!1;if(e.type===CLASS){let i=SkyEngine.Screen.findNodesByClass(e);for(let t=0;t<i.length;t+=1){let e=i[t];if(e!==n&&n.checkOneSideCollision(e)===!0)return!0}}else{if(e.checkIsHiding()===!0)return!1;for(let n=0;n<Ce.length;n+=1)if(e.checkIsRemoved()!==!0){let i=Ce[n],t=e.getColliders();for(let o=0;o<t.length;o+=1){let e=t[o];if(i.checkArea(e)===!0||e.checkArea(i)===!0)return!0}}for(let n=0;n<Ee.length;n+=1)if(Ee[n].checkOneSideCollision(e)===!0)return!0}return!1}),n.checkCollision=(e=>{if(e.type===CLASS){let i=SkyEngine.Screen.findNodesByClass(e);for(let t=0;t<i.length;t+=1){let e=i[t];if(e!==n&&e.checkIsRemoved()!==!0&&(n.checkOneSideCollision(e)===!0||n.type!==e.type&&e.checkOneSideCollision(n)===!0))return!0}}else if(e.checkIsRemoved()!==!0&&(n.checkOneSideCollision(e)===!0||n.type!==e.type&&e.checkOneSideCollision(n)===!0))return!0;return!1}),n.checkOffScreen=(()=>{for(let e=0;e<Ee.length;e+=1)if(Ee[e].checkOffScreen()!==!0)return!1;return!0}),()=>{for(let e=0;e<xe.length;e+=1){let i=xe[e];if(i.type===CLASS){let e=SkyEngine.Screen.findNodesByClass(i);for(let t=0;t<e.length;t+=1){let o=e[t];o!==n&&(o.checkIsRemoved()!==!0?(cn()===!0||o.checkIsToCheckCollision()===!0||(void 0===Te||Math.abs(b-o.getRealX())<Te)&&(void 0===Ae||Math.abs(B-o.getRealY())<Ae))&&(n.checkOneSideCollision(o)===!0||n.type!==o.type&&o.checkOneSideCollision(n)===!0)?ke!==!0&&(Ie[o.id]=!0,nn(i,o)):ke!==!0&&void 0!==Ie[o.id]&&(delete Ie[o.id],tn(i,o)):delete Ie[o.id])}}else i.checkIsRemoved()!==!0?(cn()===!0||i.checkIsToCheckCollision()===!0||(void 0===Te||Math.abs(b-i.getRealX())<Te)&&(void 0===Ae||Math.abs(B-i.getRealY())<Ae))&&(n.checkOneSideCollision(i)===!0||n.type!==i.type&&i.checkOneSideCollision(n)===!0)?void 0===Ie[i.id]&&(Ie[i.id]=!0,nn(i,i)):void 0!==Ie[i.id]&&(delete Ie[i.id],tn(i,i)):(xe.splice(e,1),e-=1,delete Ie[i.id],delete Ye[i.id],delete Xe[i.id]);if(void 0===xe)break}}),cn=(n.step=(e=>{if(0===De){if(j=t,Q=o,0!==p&&(u+=p*e),void 0!==w&&u<w&&(u=w,0===u)){if(void 0!==ee){let e=ee;ee=void 0,e()}if(void 0!==$&&0===S){let e=$;$=void 0,e()}}if(void 0!==T&&u>T&&(u=T,0===u)){if(void 0!==ee){let e=ee;ee=void 0,e()}if(void 0!==$&&0===S){let e=$;$=void 0,e()}}if(0!==E&&(S+=E*e),void 0!==x&&S<x&&(S=x,0===S)){if(void 0!==ne){let e=ne;ne=void 0,e()}if(void 0!==$&&0===u){let e=$;$=void 0,e()}}if(void 0!==A&&S>A&&(S=A,0===S)){if(void 0!==ne){let e=ne;ne=void 0,e()}if(void 0!==$&&0===u){let e=$;$=void 0,e()}}if(0!==u){let n=u*e;if((n<0&&ue!==!0||n>0&&Se!==!0)&&(t+=n,void 0!==W&&(u>0&&t>W||u<0&&t<W))){if(t=W,W=void 0,w=void 0,T=void 0,u=0,p=0,void 0!==ee){let e=ee;ee=void 0,e()}if(void 0!==$&&0===S){let e=$;$=void 0,e()}}}if(0!==S){let n=S*e;if((n<0&&se!==!0||n>0&&ve!==!0)&&(o+=n,void 0!==F&&(S>0&&o>F||S<0&&o<F))){if(o=F,F=void 0,x=void 0,A=void 0,S=0,E=0,void 0!==ne){let e=ne;ne=void 0,e()}if(void 0!==$&&0===u){let e=$;$=void 0,e()}}}if(0!==y&&(s+=y*e),void 0!==I&&s<I&&(s=I),void 0!==P&&s>P&&(s=P),0!==k&&(v+=k*e),void 0!==Y&&v<Y&&(v=Y),void 0!==O&&v>O&&(v=O),0!==s&&(l+=s*e,void 0!==N&&(s>0&&l>N||s<0&&l<N))){if(l=N,N=void 0,I=void 0,P=void 0,s=0,y=0,void 0!==te){let e=te;te=void 0,e()}if(void 0!==ie&&0===v){let e=ie;ie=void 0,e()}}if(0!==v&&(d+=v*e,void 0!==L&&(v>0&&d>L||v<0&&d<L))){if(d=L,L=void 0,Y=void 0,O=void 0,v=0,k=0,void 0!==oe){let e=oe;oe=void 0,e()}if(void 0!==ie&&0===s){let e=ie;ie=void 0,e()}}if(0!==m&&(h+=m*e),void 0!==X&&h<X&&(h=X),void 0!==M&&h>M&&(h=M),0!==h){if(g+=h*e,void 0!==V&&g+V<360&&(h>0&&g>=V||h<0&&g<=V)&&(g=V,V=void 0,X=void 0,M=void 0,h=0,m=0,void 0!==ce)){let e=ce;ce=void 0,e()}g>=360?g=0:g<=0&&(g=360)}if(0!==C&&(R+=C*e),void 0!==D&&R<D&&(R=D),void 0!==H&&R>H&&(R=H),0!==R){if(f+=R*e,void 0!==_&&(R>0&&f>_||R<0&&f<_)&&(f=_,_=void 0,D=void 0,H=void 0,R=0,C=0,void 0!==ae)){let e=ae;ae=void 0,e()}f>1?f=1:f<0&&(f=0)}if(Be(),ke!==!0)for(let i=0;i<we.length;i+=1)we[i].step(e);if(ke!==!0)for(let i=0;i<Ce.length;i+=1)Ce[i].step(e);if(ke!==!0&&on(),ke!==!0)for(let i=0;i<Ee.length&&(Ee[i].step(e),void 0!==Ee);i+=1);ke!==!0&&void 0!==me.offscreen&&n.checkOffScreen()===!0&&en("offscreen"),ke!==!0&&void 0!==me.nextstep&&(en("nextstep"),$e("nextstep")),ke===!0||void 0===me.move||t===j&&o===Q||en("move")}}),n.draw=(e=>{if(void 0!==he){let n=SkyEngine.Screen.getRatio();he.addStyle({left:SkyEngine.Screen.getLeft()+(SkyEngine.Screen.getWidth()/2+U-SkyEngine.Screen.getCameraFollowX())*n-he.getWidth()/2,top:SkyEngine.Screen.getTop()+(SkyEngine.Screen.getHeight()/2+G-SkyEngine.Screen.getCameraFollowY())*n-he.getHeight()/2,transform:"rotate("+z+"rad) scale("+n*K+", "+n*q+")",opacity:e.globalAlpha,filter:e.filter})}}),n.drawArea=(e=>{}),n.pause=(()=>{De+=1}),n.checkIsPaused=(()=>{return De>0}),n.resume=(()=>{De-=1,De<0&&(De=0)}),n.checkIsToCheckCollision=(()=>{return fe}));Be()},afterInit:(e,n,i)=>{void 0!==i&&(void 0!==i.c&&(CHECK_IS_ARRAY(i.c)===!0?EACH(i.c,e=>{n.append(e)}):n.append(i.c)),void 0!==i.dom&&(CHECK_IS_ARRAY(i.dom)===!0?EACH(i.dom,e=>{n.addDom(e)}):n.addDom(i.dom)),void 0!==i.domStyle&&n.addDomStyle(i.domStyle),void 0!==i.on&&EACH(i.on,(e,i)=>{n.on(i,e)}),void 0!==i.touchArea&&(CHECK_IS_ARRAY(i.touchArea)===!0?EACH(i.touchArea,e=>{n.addTouchArea(e)}):n.addTouchArea(i.touchArea)),void 0!==i.collider&&(CHECK_IS_ARRAY(i.collider)===!0?EACH(i.collider,e=>{n.addCollider(e)}):n.addCollider(i.collider)))}}),SkyEngine.Screen=OBJECT({preset:()=>{return SkyEngine.Node},init:(e,n)=>{let i,t,o,c,a,r,l,d,g,f,u,S,s,v,h=DIV({style:{position:"fixed",left:0,top:0,zIndex:-1}}).appendTo(BODY),R=CANVAS().appendTo(h),p=R.getContext("2d"),E={},y=0,k=0,m=(n.registerNode=(e=>{let n=e.type;for(;void 0!==n&&n!==CLASS;)void 0===E[n.id]&&(E[n.id]=[]),E[n.id].push(e),n=n.mom}),n.unregisterNode=(e=>{let n=e.type;for(;void 0!==n&&n!==CLASS;){if(void 0!==E[n.id]){let i=E[n.id];for(let t=0;t<i.length;t+=1)if(i[t]===e){i.splice(t,1);break}0===E[n.id].length&&delete E[n.id]}n=n.mom}}),n.findNodesByClass=(e=>{return void 0===E[e.id]?[]:E[e.id]}));if(BROWSER_CONFIG.SkyEngine.isDebugMode===!0){let e=DIV({style:{position:"fixed",left:5,top:5,fontSize:12,zIndex:999999}}).appendTo(BODY);INTERVAL(.1,()=>{void 0!==r&&(e.empty(),e.append("FPS: "+parseInt(1/r)))})}EACH(["tap","touchstart","touchend"],e=>{R.on(e,i=>{let t,o=n=>{if(t!==!0&&(REVERSE_EACH(n.getChildren(),o),n.checkIsEventExists(e)===!0&&n.checkTouch((i.getLeft()-WIN_WIDTH()/2)/a,(i.getTop()-WIN_HEIGHT()/2)/a)===!0)){let o=SkyEngine.E(i);n.fireEvent({eventName:e,e:o}),o.checkIsBubblingStoped()===!0&&(t=!0)}};o(n)})});let C=(e,n,i)=>{n.save(),n.translate(e.getDrawingX(),e.getDrawingY()),n.rotate(e.getRealRadian()),n.scale(e.getRealScaleX(),e.getRealScaleY()),n.lineWidth=1/(e.getRealScaleX()>e.getRealScaleY()?e.getRealScaleX():e.getRealScaleY()),n.beginPath(),e.drawArea(n),n.strokeStyle=i,n.stroke(),n.closePath(),n.restore();let t=e.getChildren();for(let o=0;o<t.length;o+=1)C(t[o],n,i)},w=(e,n,i)=>{if(e.checkIsHiding()!==!0){if(i*=e.getAlpha(),n.save(),void 0!==e.getFilter()&&(n.filter=e.getFilter()),void 0!==e.getBlendMode()&&(n.globalCompositeOperation=e.getBlendMode()),n.save(),n.translate(e.getDrawingX(),e.getDrawingY()),n.rotate(e.getRealRadian()),n.scale(e.getRealScaleX(),e.getRealScaleY()),n.globalAlpha=i,e.draw(n),n.restore(),e.checkIsRemoved()!==!0){let t=e.getChildren();for(let o=0;o<t.length;o+=1)w(t[o],n,i)}if(n.restore(),e.checkIsRemoved()!==!0&&BROWSER_CONFIG.SkyEngine.isDebugMode===!0){n.beginPath(),n.strokeStyle=n.fillStyle="aqua";let i=e.getRealX(),t=e.getRealY();n.rect(i-1,t-1,2,2),n.moveTo(i-15,t),n.lineTo(i+15,t),n.moveTo(i,t-15),n.lineTo(i,t+15),n.stroke();let o=e.getTouchAreas();for(let c=0;c<o.length;c+=1)C(o[c],n,"magenta");let a=e.getColliders();for(let c=0;c<a.length;c+=1)C(a[c],n,"lime")}}},x=LOOP(e=>{if(r=e,r>.03&&(r=.03),n.checkIsPaused()!==!0){SkyEngine.Delay.step(r),SkyEngine.Interval.step(r),n.step(r);let e=m(SkyEngine.FixedNode);for(let i=0;i<e.length;i+=1)e[i].step(0)}P.step(r),p.clearRect(0,0,o*devicePixelRatio,c*devicePixelRatio),p.save(),p.scale(devicePixelRatio,devicePixelRatio),p.translate(o/2-T(),c/2-A()),w(n,p,n.getAlpha()),p.restore()});EVENT("resize",RAR(()=>{let e=WIN_WIDTH(),n=WIN_HEIGHT();o=void 0!==BROWSER_CONFIG.SkyEngine.width?BROWSER_CONFIG.SkyEngine.width:e,c=void 0!==BROWSER_CONFIG.SkyEngine.height?BROWSER_CONFIG.SkyEngine.height:n;let r=e/o,l=n/c;a=r<l?r:l,void 0===BROWSER_CONFIG.SkyEngine.width&&(o/=a),void 0===BROWSER_CONFIG.SkyEngine.height&&(c/=a),void 0!==BROWSER_CONFIG.SkyEngine.maxWidth&&o>BROWSER_CONFIG.SkyEngine.maxWidth&&(o=BROWSER_CONFIG.SkyEngine.maxWidth),void 0!==BROWSER_CONFIG.SkyEngine.maxHeight&&c>BROWSER_CONFIG.SkyEngine.maxHeight&&(c=BROWSER_CONFIG.SkyEngine.maxHeight),R.addStyle({width:o*a,height:c*a}),i=(e-o*a)/2,t=(n-c*a)/2,h.addStyle({left:i,top:t}),R.setSize({width:o*devicePixelRatio,height:c*devicePixelRatio})})),n.on("remove",()=>{x.remove()});let I=n.cameraFollowX=(e=>{g=e.target,l=e.centerX,void 0===l&&(l=0),u=e.minX,s=e.maxX}),Y=n.cameraFollowY=(e=>{f=e.target,d=e.centerY,void 0===d&&(d=0),S=e.minY,v=e.maxY}),X=(n.cameraFollow=(e=>{I(e),Y(e)}),n.cameraUnfollowX=(()=>{g=void 0,u=void 0,s=void 0})),D=n.cameraUnfollowY=(()=>{f=void 0,S=void 0,v=void 0}),T=(n.cameraUnfollow=(()=>{X(),D()}),n.getCameraFollowX=(()=>{return void 0===g?y:g.checkIsRemoved()===!0?(g=void 0,y):(y=g.getRealX()-l,void 0!==u&&y<u?u:void 0!==s&&y>s?s:y)})),A=n.getCameraFollowY=(()=>{return void 0===f?k:f.checkIsRemoved()===!0?(f=void 0,k):(k=f.getRealY()-d,void 0!==S&&k<S?S:void 0!==v&&k>v?v:k)}),P=(n.getLeft=(()=>{return i}),n.getTop=(()=>{return t}),n.getWidth=(()=>{return o}),n.getHeight=(()=>{return c}),n.getRatio=(()=>{return a}),n.getCanvas=(()=>{return R}),n.getCanvasContext=(()=>{return p}),SkyEngine.Node());n.getNonePausableNode=(()=>{return P})}}),SkyEngine.TextBorderShadow=METHOD({run:e=>{return"1px 1px 0 "+e+",-1px 1px 0 "+e+",1px -1px 0 "+e+",-1px -1px 0 "+e+",0px 1px 0 "+e+",0px -1px 0 "+e+",-1px 0px 0 "+e+",1px 0px 0 "+e+",2px 2px 0 "+e+",-2px 2px 0 "+e+",2px -2px 0 "+e+",-2px -2px 0 "+e+",0px 2px 0 "+e+",0px -2px 0 "+e+",-2px 0px 0 "+e+",2px 0px 0 "+e+",1px 2px 0 "+e+",-1px 2px 0 "+e+",1px -2px 0 "+e+",-1px -2px 0 "+e+",2px 1px 0 "+e+",-2px 1px 0 "+e+",2px -1px 0 "+e+",-2px -1px 0 "+e}}),SkyEngine.Figure=CLASS({preset:()=>{return SkyEngine.Node},init:(e,n,i)=>{let t,o,c,a=i.color,r=i.border;if(void 0!==r){let e=r.split(" ");t=INTEGER(e[0]),o=e[1],c=e[2]}let l;OVERRIDE(n.draw,e=>{l=n.draw=(n=>{void 0!==a&&(n.fillStyle=a,n.fill()),void 0!==r&&(n.lineWidth=t,n.strokeStyle=c,"dashed"===o?n.setLineDash([5]):"dotted"===o&&n.setLineDash([2]),n.stroke()),n.closePath(),e(n)})});let d;OVERRIDE(n.drawArea,e=>{d=n.drawArea=(n=>{e(n)})})}}),SkyEngine.FixedNode=CLASS({preset:()=>{return SkyEngine.Node},init:(e,n,i)=>{let t;void 0!==i&&(t=i.followScreenRatio),void 0===t&&(t=0);let o,c=0,a=0;OVERRIDE(n.step,e=>{o=n.step=(i=>{if(1!==t){let e=SkyEngine.Screen.getCameraFollowX()-SkyEngine.Screen.getX(),i=SkyEngine.Screen.getCameraFollowY()-SkyEngine.Screen.getY();n.setX(n.getX()+(e-c)*(1-t)/n.getRealScaleX()),n.setY(n.getY()+(i-a)*(1-t)/n.getRealScaleY()),c=e,a=i}e(i)})})}}),SkyEngine.StateSet=CLASS({preset:()=>{return SkyEngine.Node},init:(e,n,i)=>{let t,o,c={},a=n.setStateNode=(e=>{let i=e.state,t=e.node;void 0!==c[name]&&c[name].remove(),t.hide(),n.append(t),c[i]=t});EACH(i.stateNodes,(e,n)=>{a({state:n,node:e})});let r=n.setState=((e,n)=>{void 0!==o&&(c[t].off("animationend",o),o=void 0),t=e,o=n,EACH(c,e=>{e.hide()});let i=c[t];void 0!==i&&i.show(),void 0!==o&&i.on("animationend",o)});r(i.baseState);n.getState=(()=>{return t})}}),SkyEngine.Circle=CLASS(e=>{e.findRaycastPoints=((e,n,i,t,o,c,a,r,l,d)=>{let g=d*e+l*n-i,f=-l*e+d*n-t;o*=a,c*=r;let u=o/2,S=c/2,s=99999,v=(1-g*s/u/u*S*S)/f+t;s+=i;let h=-99999,R=(1-g*h/u/u*S*S)/f+t;return h+=i,SkyEngine.Line.findCircleIntersectionPoints(0,0,s,v,h,R,1,1,0,1,i,t,o,c,1,1,l,d)});return{preset:()=>{return SkyEngine.Figure},init:(n,i,t)=>{let o=t.width,c=t.height,a=SkyEngine.Util.Collision.checkPointInCircle,r=SkyEngine.Util.Collision.checkLineCircle,l=SkyEngine.Util.Collision.checkRectCircle,d=SkyEngine.Util.Collision.checkCircleCircle;i.setWidth=(e=>{o=e}),i.getWidth=(()=>{return o}),i.setHeight=(e=>{c=e}),i.getHeight=(()=>{return c});OVERRIDE(i.checkPoint,e=>{i.checkPoint=((n,t)=>{return a(n,t,i.getDrawingX(),i.getDrawingY(),o,c,i.getRealScaleX(),i.getRealScaleY(),i.getRealSin(),i.getRealCos())===!0||e(n,t)===!0})});let g;OVERRIDE(i.checkArea,e=>{g=i.checkArea=(n=>{if(n.type===SkyEngine.Line){if(r(n.getDrawingX(),n.getDrawingY(),n.getStartX(),n.getStartY(),n.getEndX(),n.getEndY(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),i.getDrawingX(),i.getDrawingY(),o,c,i.getRealScaleX(),i.getRealScaleY(),i.getRealSin(),i.getRealCos())===!0)return!0}else if(n.type===SkyEngine.Rect){if(l(n.getDrawingX(),n.getDrawingY(),n.getWidth(),n.getHeight(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),i.getDrawingX(),i.getDrawingY(),o,c,i.getRealScaleX(),i.getRealScaleY(),i.getRealSin(),i.getRealCos())===!0)return!0}else if(n.type===SkyEngine.Circle&&d(n.getDrawingX(),n.getDrawingY(),n.getWidth(),n.getHeight(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),i.getDrawingX(),i.getDrawingY(),o,c,i.getRealScaleX(),i.getRealScaleY(),i.getRealSin(),i.getRealCos())===!0)return!0;return e(n)})});let f;OVERRIDE(i.checkOffScreen,e=>{f=i.checkOffScreen=(()=>{return l(SkyEngine.Screen.getCameraFollowX(),SkyEngine.Screen.getCameraFollowY(),SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,i.getDrawingX(),i.getDrawingY(),o,c,i.getRealScaleX(),i.getRealScaleY(),i.getRealSin(),i.getRealCos())!==!0&&e()})});let u;OVERRIDE(i.draw,e=>{u=i.draw=(n=>{n.beginPath(),n.ellipse(0,0,o/2,c/2,0,0,2*Math.PI),e(n)})});let S;OVERRIDE(i.drawArea,e=>{S=i.drawArea=(n=>{n.ellipse(0,0,o/2,c/2,0,0,2*Math.PI),e(n)})});i.findRaycastPoints=((n,t)=>{return e.findRaycastPoints(n,t,i.getDrawingX(),i.getDrawingY(),o,c,i.getRealScaleX(),i.getRealScaleY(),i.getRealSin(),i.getRealCos())})}}}),SkyEngine.Line=CLASS(e=>{let n=e.findLineIntersectionPoint=((e,n,i,t,o,c,a,r,l,d,g,f,u,S,s,v,h,R,p,E)=>{if(SkyEngine.Util.Collision.checkLineLine(e,n,i,t,o,c,a,r,l,d,g,f,u,S,s,v,h,R,p,E)===!0){i*=a,t*=r;let y=e+d*i+l*t,k=n+l*i+d*t;o*=a,c*=r;let m=e+d*o+l*c,C=n+l*o+d*c;u*=h,S*=R;let w=g+E*u+p*S,x=f+p*u+E*S;s*=h,v*=R;let I=g+E*s+p*v,Y=f+p*s+E*v,X=(m-y)*(Y-x)-(I-w)*(C-k);return{x:((m*k-C*y)*(I-w)-(m-y)*(I*x-Y*w))/X,y:((m*k-C*y)*(Y-x)-(C-k)*(I*x-Y*w))/X}}}),i=e.findRectIntersectionPoints=((e,i,t,o,c,a,r,l,d,g,f,u,S,s,v,h,R,p)=>{let E=[];t*=r,o*=l;let y=e+g*t+d*o,k=i+d*t+g*o;c*=r,a*=l;let m,C,w,x,I,Y,X,D,T=e+g*c+d*a,A=i+d*c+g*a;S*=v/2,s*=h/2;let P=p*S,O=p*s,M=-R*S,H=-R*s;m=f-P-H,C=u+M-O,w=f+P-H,x=u-M-O,I=f+P+H,Y=u-M+O,X=f-P+H,D=u+M+O;let W=n(0,0,y,k,T,A,1,1,0,1,0,0,m,C,w,x,1,1,0,1);return void 0!==W&&E.push(W),W=n(0,0,y,k,T,A,1,1,0,1,0,0,w,x,I,Y,1,1,0,1),void 0!==W&&E.push(W),W=n(0,0,y,k,T,A,1,1,0,1,0,0,I,Y,X,D,1,1,0,1),void 0!==W&&E.push(W),W=n(0,0,y,k,T,A,1,1,0,1,0,0,X,D,m,C,1,1,0,1),void 0!==W&&E.push(W),E}),t=e.findCircleIntersectionPoints=((e,n,i,t,o,c,a,r,l,d,g,f,u,S,s,v,h,R)=>{let p=[];if(SkyEngine.Util.Collision.checkLineCircle(e,n,i,t,o,c,a,r,l,d,g,f,u,S,s,v,h,R)===!0){i*=a,t*=r;let E=e+d*i+l*t-g,y=n+l*i+d*t-f;o*=a,c*=r;let k=e+d*o+l*c-g,m=n+l*o+d*c-f,C=R*E+h*y,w=-h*E+R*y,x=R*k+h*m,I=-h*k+R*m;u*=s,S*=v;let Y=u/2,X=S/2,D=(I-w)/(x-C),T=w-D*C,A=D*D*Y*Y+X*X,P=2*D*T*Y*Y,O=Y*Y*T*T-Y*Y*X*X,M=P*P-4*A*O;if(M>0){let e=(-P+Math.sqrt(M))/(2*A),n=D*e+T,i=(-P-Math.sqrt(M))/(2*A),t=D*i+T;(C<x?C:x)<=e&&e<=(C<x?x:C)&&(w<I?w:I)<=n&&n<=(w<I?I:w)&&p.push({x:R*e-h*n+g,y:h*e+R*n+f}),(C<x?C:x)<=i&&i<=(C<x?x:C)&&(w<I?w:I)<=t&&t<=(w<I?I:w)&&p.push({x:R*i-h*t+g,y:h*i+R*t+f})}else if(0===M){let e=-P/(2*A),n=D*e+T;(C<x?C:x)<=e&&e<=(C<x?x:C)&&(w<I?w:I)<=n&&n<=(w<I?I:w)&&p.push({x:R*e-h*n+g,y:h*e+R*n+f})}}return p}),o=e.findPolygonIntersectionPoints=((e,i,t,o,c,a,r,l,d,g,f,u,S,s,v,h,R)=>{let p=[];t*=r,o*=l;let E=e+g*t+d*o,y=i+d*t+g*o;c*=r,a*=l;let k=e+g*c+d*a,m=i+d*c+g*a,C=S.length;for(let w=0,x=C-1;w<C;x=w,w+=1){let e=S[w].x*s,i=S[w].y*v,t=S[x].x*s,o=S[x].y*v,c=f+R*e-h*i,a=u+h*e+R*i,r=f+R*t-h*o,l=u+h*t+R*o,d=n(0,0,E,y,k,m,1,1,0,1,0,0,c,a,r,l,1,1,0,1);void 0!==d&&p.push(d)}return p});return{preset:()=>{return SkyEngine.Figure},init:(e,c,a)=>{let r=a.startX,l=a.startY,d=a.endX,g=a.endY,f=a.isEndless,u=SkyEngine.Util.Collision.checkLineLine,S=SkyEngine.Util.Collision.checkLineRect;f===!0&&(Math.abs(d-r)<Math.abs(g-l)?(d=((g-l<0?-999999:999999)-l)/(g-l)*(d-r)+r,g=g-l<0?-999999:999999):(g=(g-l)/(d-r)*((d-r<0?-999999:999999)-r)+l,d=d-r<0?-999999:999999));let s;c.setStartX=(e=>{r=e}),c.getStartX=(()=>{return r}),c.setStartY=(e=>{l=e}),c.getStartY=(()=>{return l}),c.setEndX=(e=>{d=e}),c.getEndX=(()=>{return d}),c.setEndY=(e=>{g=e}),c.getEndY=(()=>{return g});OVERRIDE(c.checkArea,e=>{s=c.checkArea=(n=>{return n.type===SkyEngine.Line&&u(n.getDrawingX(),n.getDrawingY(),n.getStartX(),n.getStartY(),n.getEndX(),n.getEndY(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),c.getDrawingX(),c.getDrawingY(),r,l,d,g,c.getRealScaleX(),c.getRealScaleY(),c.getRealSin(),c.getRealCos())===!0||e(n)})});let v;OVERRIDE(c.checkOffScreen,e=>{v=c.checkOffScreen=(()=>{
return S(c.getDrawingX(),c.getDrawingY(),r,l,d,g,c.getRealScaleX(),c.getRealScaleY(),c.getRealSin(),c.getRealCos(),SkyEngine.Screen.getCameraFollowX(),SkyEngine.Screen.getCameraFollowY(),SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1)!==!0&&e()})});let h;OVERRIDE(c.draw,e=>{h=c.draw=(n=>{n.beginPath(),n.moveTo(r,l),n.lineTo(d,g),e(n)})});let R;OVERRIDE(c.drawArea,e=>{R=c.drawArea=(n=>{n.moveTo(r,l),n.lineTo(d,g),e(n)})});c.findIntersectionPoints=(e=>{let a=[];if(e.checkIsInstanceOf(SkyEngine.Line)===!0){let i=n(c.getDrawingX(),c.getDrawingY(),r,l,d,g,c.getRealScaleX(),c.getRealScaleY(),c.getRealSin(),c.getRealCos(),e.getDrawingX(),e.getDrawingY(),e.getStartX(),e.getStartY(),e.getEndX(),e.getEndY(),e.getRealScaleX(),e.getRealScaleY(),e.getRealSin(),e.getRealCos());void 0!==i&&a.push(i)}else e.checkIsInstanceOf(SkyEngine.Rect)===!0?a=i(c.getDrawingX(),c.getDrawingY(),r,l,d,g,c.getRealScaleX(),c.getRealScaleY(),c.getRealSin(),c.getRealCos(),e.getDrawingX(),e.getDrawingY(),e.getWidth(),e.getHeight(),e.getRealScaleX(),e.getRealScaleY(),e.getRealSin(),e.getRealCos()):e.checkIsInstanceOf(SkyEngine.Circle)===!0?a=t(c.getDrawingX(),c.getDrawingY(),r,l,d,g,c.getRealScaleX(),c.getRealScaleY(),c.getRealSin(),c.getRealCos(),e.getDrawingX(),e.getDrawingY(),e.getWidth(),e.getHeight(),e.getRealScaleX(),e.getRealScaleY(),e.getRealSin(),e.getRealCos()):e.checkIsInstanceOf(SkyEngine.Polygon)===!0&&(a=o(c.getDrawingX(),c.getDrawingY(),r,l,d,g,c.getRealScaleX(),c.getRealScaleY(),c.getRealSin(),c.getRealCos(),e.getDrawingX(),e.getDrawingY(),e.getPoints(),e.getRealScaleX(),e.getRealScaleY(),e.getRealSin(),e.getRealCos()));return a})}}}),SkyEngine.Polygon=CLASS(e=>{e.findRaycastPoints=((e,n,i,t,o,c,a,r,l)=>{let d,g,f,u,S,s,v=o.length;for(let h=0;h<v;h+=1){let v=o[h].x*c,R=o[h].y*a,p=i+l*v-r*R,E=t+r*v+l*R,y=p-e,k=E-n,m=Math.acos(y/Math.sqrt(y*y+k*k));k>0&&(m=Math.PI+Math.PI-m),(void 0==d||d>m)&&(d=m,g=p,f=E),(void 0==u||u<m)&&(u=m,S=p,s=E)}return void 0===d?[]:[{x:g,y:f},{x:S,y:s}]});return{preset:()=>{return SkyEngine.Figure},init:(n,i,t)=>{let o=t.points,c=SkyEngine.Util.Collision.checkPointInPolygon,a=SkyEngine.Util.Collision.checkLinePolygon,r=SkyEngine.Util.Collision.checkRectPolygon,l=SkyEngine.Util.Collision.checkCirclePolygon,d=SkyEngine.Util.Collision.checkPolygonPolygon;i.getPoints=(()=>{return o}),i.setColor=(e=>{e=_color}),i.getColor=(()=>{return color});OVERRIDE(i.checkPoint,e=>{i.checkPoint=((n,t)=>{return c(n,t,i.getDrawingX(),i.getDrawingY(),o,i.getRealScaleX(),i.getRealScaleY(),i.getRealSin(),i.getRealCos())===!0||e(n,t)===!0})});let g;OVERRIDE(i.checkArea,e=>{g=i.checkArea=(n=>{if(n.type===SkyEngine.Line){if(a(n.getDrawingX(),n.getDrawingY(),n.getStartX(),n.getStartY(),n.getEndX(),n.getEndY(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),i.getDrawingX(),i.getDrawingY(),o,i.getRealScaleX(),i.getRealScaleY(),i.getRealSin(),i.getRealCos())===!0)return!0}else if(n.type===SkyEngine.Rect){if(r(n.getDrawingX(),n.getDrawingY(),n.getWidth(),n.getHeight(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),i.getDrawingX(),i.getDrawingY(),o,i.getRealScaleX(),i.getRealScaleY(),i.getRealSin(),i.getRealCos())===!0)return!0}else if(n.type===SkyEngine.Circle){if(l(n.getDrawingX(),n.getDrawingY(),n.getWidth(),n.getHeight(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),i.getDrawingX(),i.getDrawingY(),o,i.getRealScaleX(),i.getRealScaleY(),i.getRealSin(),i.getRealCos())===!0)return!0}else if(n.type===SkyEngine.Polygon&&d(n.getDrawingX(),n.getDrawingY(),n.getPoints(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),i.getDrawingX(),i.getDrawingY(),o,i.getRealScaleX(),i.getRealScaleY(),i.getRealSin(),i.getRealCos())===!0)return!0;return e(n)})});let f;OVERRIDE(i.checkOffScreen,e=>{f=i.checkOffScreen=(()=>{return r(SkyEngine.Screen.getCameraFollowX(),SkyEngine.Screen.getCameraFollowY(),SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,i.getDrawingX(),i.getDrawingY(),o,i.getRealScaleX(),i.getRealScaleY(),i.getRealSin(),i.getRealCos())!==!0&&e()})});let u;OVERRIDE(i.draw,e=>{u=i.draw=(n=>{if(n.beginPath(),o.length>0){n.moveTo(o[0].x,o[0].y);for(let e=1;e<o.length;e+=1){let i=o[e];n.lineTo(i.x,i.y)}n.lineTo(o[0].x,o[0].y)}e(n)})});let S;OVERRIDE(i.drawArea,e=>{S=i.drawArea=(n=>{if(o.length>0){n.moveTo(o[0].x,o[0].y);for(let e=1;e<o.length;e+=1){let i=o[e];n.lineTo(i.x,i.y)}n.lineTo(o[0].x,o[0].y)}e(n)})});i.findRaycastPoints=((n,t)=>{return e.findRaycastPoints(n,t,i.getDrawingX(),i.getDrawingY(),o,i.getRealScaleX(),i.getRealScaleY(),i.getRealSin(),i.getRealCos())})}}}),SkyEngine.Rect=CLASS(e=>{e.findRaycastPoints=((e,n,i,t,o,c,a,r,l,d)=>{let g,f,u,S,s,v,h,R;o*=a,c*=r;let p=d*o/2,E=d*c/2,y=-l*o/2,k=-l*c/2;g=i-p-k,f=t+y-E,u=i+p-k,S=t-y-E,s=i+p+k,v=t-y+E,h=i-p+k,R=t+y+E;let m=g-e,C=f-n,w=Math.acos(m/Math.sqrt(m*m+C*C));C>0&&(w=Math.PI+Math.PI-w);let x=w,I=g,Y=f,X=w,D=g,T=f;return m=u-e,C=S-n,w=Math.acos(m/Math.sqrt(m*m+C*C)),C>0&&(w=Math.PI+Math.PI-w),x>w&&(x=w,I=u,Y=S),X<w&&(X=w,D=u,T=S),m=s-e,C=v-n,w=Math.acos(m/Math.sqrt(m*m+C*C)),C>0&&(w=Math.PI+Math.PI-w),x>w&&(x=w,I=s,Y=v),X<w&&(X=w,D=s,T=v),m=h-e,C=R-n,w=Math.acos(m/Math.sqrt(m*m+C*C)),C>0&&(w=Math.PI+Math.PI-w),x>w&&(x=w,I=h,Y=R),X<w&&(X=w,D=h,T=R),[{x:I,y:Y},{x:D,y:T}]});return{preset:()=>{return SkyEngine.Figure},init:(n,i,t)=>{let o=t.width,c=t.height,a=SkyEngine.Util.Collision.checkPointInRect,r=SkyEngine.Util.Collision.checkLineRect,l=SkyEngine.Util.Collision.checkRectRect;i.setWidth=(e=>{o=e}),i.getWidth=(()=>{return o}),i.setHeight=(e=>{c=e}),i.getHeight=(()=>{return c}),i.setColor=(e=>{e=_color}),i.getColor=(()=>{return color});OVERRIDE(i.checkPoint,e=>{i.checkPoint=((n,t)=>{return a(n,t,i.getDrawingX(),i.getDrawingY(),o,c,i.getRealScaleX(),i.getRealScaleY(),i.getRealSin(),i.getRealCos())===!0||e(n,t)===!0})});let d;OVERRIDE(i.checkArea,e=>{d=i.checkArea=(n=>{if(n.type===SkyEngine.Line){if(r(n.getDrawingX(),n.getDrawingY(),n.getStartX(),n.getStartY(),n.getEndX(),n.getEndY(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),i.getDrawingX(),i.getDrawingY(),o,c,i.getRealScaleX(),i.getRealScaleY(),i.getRealSin(),i.getRealCos())===!0)return!0}else if(n.type===SkyEngine.Rect&&l(n.getDrawingX(),n.getDrawingY(),n.getWidth(),n.getHeight(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),i.getDrawingX(),i.getDrawingY(),o,c,i.getRealScaleX(),i.getRealScaleY(),i.getRealSin(),i.getRealCos())===!0)return!0;return e(n)})});let g;OVERRIDE(i.checkOffScreen,e=>{g=i.checkOffScreen=(()=>{return l(SkyEngine.Screen.getCameraFollowX(),SkyEngine.Screen.getCameraFollowY(),SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,i.getDrawingX(),i.getDrawingY(),o,c,i.getRealScaleX(),i.getRealScaleY(),i.getRealSin(),i.getRealCos())!==!0&&e()})});let f;OVERRIDE(i.draw,e=>{f=i.draw=(n=>{n.beginPath(),n.rect(-o/2,-c/2,o,c),e(n)})});let u;OVERRIDE(i.drawArea,e=>{u=i.drawArea=(n=>{n.rect(-o/2,-c/2,o,c),e(n)})});i.findRaycastPoints=((n,t)=>{return e.findRaycastPoints(n,t,i.getDrawingX(),i.getDrawingY(),o,c,i.getRealScaleX(),i.getRealScaleY(),i.getRealSin(),i.getRealCos())})}}}),SkyEngine.Background=CLASS({preset:()=>{return SkyEngine.FixedNode},init:(e,n,i)=>{let t=i.src,o=i.isNotToRepeatX,c=i.isNotToRepeatY,a=i.leftMargin,r=i.rightMargin,l=i.topMargin,d=i.bottomMargin;void 0===a&&(a=0),void 0===r&&(r=0),void 0===l&&(l=0),void 0===d&&(d=0);let g,f,u=new Image;u.onload=(()=>{g=u.width,f=u.height,u.onload=void 0,n.fireEvent("load")}),u.src=t;let S;OVERRIDE(n.draw,e=>{S=n.draw=(i=>{if(void 0!==g)if(o===!0&&c===!0)i.drawImage(u,-g/2,-f/2,g,f);else if(o===!0){let e=-f/2,t=(SkyEngine.Screen.getCameraFollowY()-SkyEngine.Screen.getY())/SkyEngine.Screen.getRealScaleY()/n.getRealScaleY(),o=SkyEngine.Screen.getHeight()/2/SkyEngine.Screen.getRealScaleY()/n.getRealScaleY();for(;t-o<e+n.getY();)e-=l+f+d;for(;e+n.getY()<t+o;)i.drawImage(u,-g/2,e,g,f),e+=l+f+d}else if(c===!0){let e=-g/2,t=(SkyEngine.Screen.getCameraFollowX()-SkyEngine.Screen.getX())/SkyEngine.Screen.getRealScaleX()/n.getRealScaleX(),o=SkyEngine.Screen.getWidth()/2/SkyEngine.Screen.getRealScaleX()/n.getRealScaleX();for(;t-o<e+n.getX();)e-=a+g+r;for(;e+n.getX()<t+o;)i.drawImage(u,e,-f/2,g,f),e+=a+g+r}else{let e=-g/2,t=-f/2,o=(SkyEngine.Screen.getCameraFollowX()-SkyEngine.Screen.getX())/SkyEngine.Screen.getRealScaleX()/n.getRealScaleX(),c=(SkyEngine.Screen.getCameraFollowY()-SkyEngine.Screen.getY())/SkyEngine.Screen.getRealScaleY()/n.getRealScaleY(),S=SkyEngine.Screen.getWidth()/2/SkyEngine.Screen.getRealScaleX()/n.getRealScaleX(),s=SkyEngine.Screen.getHeight()/2/SkyEngine.Screen.getRealScaleY()/n.getRealScaleY();for(;o-S<e+n.getX();)e-=a+g+r;for(;c-s<t+n.getY();)t-=l+f+d;for(;t+n.getY()<c+s;){let c=e;for(;c+n.getX()<o+S;)i.drawImage(u,c,t,g,f),c+=a+g+r;t+=l+f+d}}e(i)})});let s;OVERRIDE(n.remove,e=>{s=n.remove=(()=>{u.onload=void 0,u=void 0,e()})});e.getImg=(()=>{return u})}}),SkyEngine.Image=CLASS(e=>{return{preset:()=>{return SkyEngine.Node},init:(e,n,i)=>{let t,o,c,a,r,l=i.src,d=SkyEngine.Util.Collision.checkRectRect,g=!1,f=0,u=0,S=0,s=0,v=n.setSrc=(e=>{l=e;let i=new Image;void 0===r&&(r=i),i.onload=(()=>{c=i.width,a=i.height,i.onload=void 0,r=i,n.fireEvent("load")}),i.src=l});v(l);let h;OVERRIDE(n.checkPoint,e=>{h=n.checkPoint=((i,o)=>{if(void 0===t){if(g!==!0){let e=new Image;e.onload=(()=>{let n=e.width,i=e.height,o=CANVAS({style:{display:"none"},width:n,height:i}).appendTo(BODY),c=o.getContext("2d");c.drawImage(e,0,0,n,i),t=c.getImageData(0,0,n,i).data,c=void 0,o.remove(),e.onload=void 0}),e.src=l,g=!0}return e(i,o)===!0}let r=i-n.getDrawingX(),d=o-n.getDrawingY(),f=Math.cos(-n.getRealRadian()),u=Math.sin(-n.getRealRadian()),S=f*r-u*d,s=f*d+u*r;return S=parseInt((S+c*n.getRealScaleX()/2)/n.getRealScaleX()),s=parseInt((s+a*n.getRealScaleY()/2)/n.getRealScaleY()),S>=0&&S<c&&s>=0&&s<a&&t[4*(s*c+S)+3]>20||e(i,o)===!0})});let R;OVERRIDE(n.checkOffScreen,e=>{R=n.checkOffScreen=(()=>{return void 0!==c&&d(SkyEngine.Screen.getCameraFollowX(),SkyEngine.Screen.getCameraFollowY(),SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,n.getDrawingX(),n.getDrawingY(),c,a,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())!==!0&&e()})});let p;OVERRIDE(n.draw,e=>{p=n.draw=(n=>{let i=c-s-u,t=a-f-S;i>0&&t>0&&n.drawImage(r,s,f,i,t,-c/2+s,-a/2+f,i,t),e(n)})});let E;OVERRIDE(n.drawArea,e=>{E=n.drawArea=(n=>{if(void 0===o)if(void 0===t){if(g!==!0){let e=new Image;e.onload=(()=>{let n=e.width,i=e.height,c=CANVAS({style:{display:"none"},width:n,height:i}).appendTo(BODY),a=c.getContext("2d");a.drawImage(e,0,0,n,i),t=a.getImageData(0,0,n,i).data,o=SkyEngine.Util.ImageData.convertImageDataToPolygonPoints(t,n),a=void 0,c.remove(),e.onload=void 0}),e.src=l,g=!0}}else o=SkyEngine.Util.ImageData.convertImageDataToPolygonPoints(t,c);else if(o.length>0){n.moveTo(o[0].x-c/2,o[0].y-a/2);for(let e=1;e<o.length;e+=1){let i=o[e];n.lineTo(i.x-c/2,i.y-a/2)}n.lineTo(o[0].x-c/2,o[0].y-a/2)}e(n)})});let y;OVERRIDE(n.remove,e=>{y=n.remove=(()=>{r.onload=void 0,r=void 0,t=void 0,o=void 0,e()})});e.getImg=(()=>{return r}),n.crop=(e=>{void 0!==e.top&&(f=e.top),void 0!==e.right&&(u=e.right),void 0!==e.bottom&&(S=e.bottom),void 0!==e.left&&(s=e.left)})}}}),SkyEngine.Silhouette=CLASS(e=>{return{preset:()=>{return SkyEngine.Node},init:(e,n,i)=>{let t,o,c,a=i.src,r=i.color,l=i.border,d=SkyEngine.Util.Collision.checkRectRect;if(void 0!==l){let e=l.split(" ");t=INTEGER(e[0]),o=e[1],c=e[2]}let g,f,u,S,s,v=n.setSrc=(e=>{a=e,g=new Image,g.onload=(()=>{S=g.width,s=g.height;let e=CANVAS({style:{display:"none"},width:S,height:s}).appendTo(BODY),i=e.getContext("2d");i.drawImage(g,0,0,S,s);let t=i.getImageData(0,0,S,s);f=t.data;let o,c=f.length;for(o=0;o<c;o+=4)f[o]=0,f[o+1]=0,f[o+2]=0;g.onload=void 0,i.clearRect(0,0,S,s),i.putImageData(t,0,0),i.globalCompositeOperation="source-in",i.rect(0,0,S,s),i.fillStyle=r,i.fill(),g.src=e.getEl().toDataURL(),t=void 0,i=void 0,e.remove(),void 0!==l&&(u=SkyEngine.Util.ImageData.convertImageDataToPolygonPoints(f,S)),n.fireEvent("load")}),g.src=a});v(a);let h;OVERRIDE(n.checkPoint,e=>{h=n.checkPoint=((i,t)=>{if(void 0===f)return e(i,t)===!0;let o=i-n.getDrawingX(),c=t-n.getDrawingY(),a=Math.cos(-n.getRealRadian()),r=Math.sin(-n.getRealRadian()),l=a*o-r*c,d=a*c+r*o;return l=parseInt((l+S*n.getRealScaleX()/2)/n.getRealScaleX()),d=parseInt((d+s*n.getRealScaleY()/2)/n.getRealScaleY()),l>=0&&l<S&&d>=0&&d<s&&f[4*(d*S+l)+3]>20||e(i,t)===!0})});let R;OVERRIDE(n.checkOffScreen,e=>{R=n.checkOffScreen=(()=>{return void 0!==S&&d(SkyEngine.Screen.getCameraFollowX(),SkyEngine.Screen.getCameraFollowY(),SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,n.getDrawingX(),n.getDrawingY(),S,s,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())!==!0&&e()})});let p;OVERRIDE(n.draw,e=>{p=n.draw=(n=>{if(void 0!==f&&(void 0!==r&&n.drawImage(g,-S/2,-s/2,S,s),void 0!==l&&u.length>0)){n.beginPath(),n.moveTo(u[0].x-S/2,u[0].y-s/2);for(let e=1;e<u.length;e+=1){let i=u[e];n.lineTo(i.x-S/2,i.y-s/2)}n.lineTo(u[0].x-S/2,u[0].y-s/2),n.lineWidth=t,n.strokeStyle=c,"dashed"===o?n.setLineDash([5]):"dotted"===o&&n.setLineDash([2]),n.stroke(),n.closePath()}e(n)})});let E;OVERRIDE(n.drawArea,e=>{E=n.drawArea=(n=>{if(void 0===u)void 0!==f&&(u=SkyEngine.Util.ImageData.convertImageDataToPolygonPoints(f,S));else if(u.length>0){n.moveTo(u[0].x-S/2,u[0].y-s/2);for(let e=1;e<u.length;e+=1){let i=u[e];n.lineTo(i.x-S/2,i.y-s/2)}n.lineTo(u[0].x-S/2,u[0].y-s/2)}e(n)})});let y;OVERRIDE(n.remove,e=>{y=n.remove=(()=>{g.onload=void 0,g=void 0,f=void 0,u=void 0,e()})});e.getImg=(()=>{return g}),e.getPolygonPoints=(()=>{return u})}}}),SkyEngine.Sprite=CLASS({preset:()=>{return SkyEngine.Node},init:(e,n,i)=>{let t,o,c,a,r,l=i.src,d=i.srcs,g=i.spriteWidth,f=i.spriteHeight,u=i.fps,S=SkyEngine.Util.Collision.checkRectRect,s=0,v=0,h=0,R=!1;void 0===u&&(u=0),void 0!==l&&(t=new Image,t.onload=(()=>{c=t.width,a=t.height,void 0===g&&(g=c),void 0===f&&(f=a),void 0===r&&(r=c/g*a/f),t.onload=void 0,n.fireEvent("load")}),t.src=l),void 0!==d&&EACH(d,e=>{let i=new Image;void 0===o&&(o=[]),i.onload=(()=>{c=i.width,a=i.height,void 0===g&&(g=c),void 0===f&&(f=a),void 0===r?r=1:r+=1,i.onload=void 0,n.fireEvent("load")}),i.src=e,o.push(i)});let p,E=(n.getFrame=(()=>{return v}),n.getBeforeFrame=(()=>{return h}),n.stop=(()=>{R=!0})),y=n.resume=(()=>{R=!1});OVERRIDE(n.hide,e=>{p=n.hide=(()=>{s=0,v=0,h=0,E(),e()})});let k;OVERRIDE(n.show,e=>{k=n.show=(()=>{s=0,v=0,h=0,y(),e()})});let m;OVERRIDE(n.checkOffScreen,e=>{m=n.checkOffScreen=(()=>{return void 0!==c&&S(SkyEngine.Screen.getCameraFollowX(),SkyEngine.Screen.getCameraFollowY(),SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,n.getDrawingX(),n.getDrawingY(),g,f,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())!==!0&&e()})});let C;OVERRIDE(n.step,e=>{C=n.step=(i=>{R!==!0&&(u>0&&(s+=u*i),void 0!==r&&s>=r&&(s-=r,n.fireEvent("animationend")),h=v,v=Math.floor(s),v!==h&&n.checkIsRemoved()!==!0&&n.fireEvent("framechange")),e(i)})});let w;OVERRIDE(n.draw,e=>{w=n.draw=(n=>{if(void 0!==o){if(void 0!==r){let e=o[v];void 0!==e&&n.drawImage(e,-c/2,-a/2,c,a)}}else void 0!==c&&void 0!==a&&void 0!==g&&void 0!==f&&n.drawImage(t,g*Math.floor(s%(c/g)),f*Math.floor(s/(c/g)),g,f,-g/2,-f/2,g,f);e(n)})});let x;OVERRIDE(n.remove,e=>{x=n.remove=(()=>{d=void 0,void 0!==t&&(t.onload=void 0,t=void 0),EACH(o,e=>{e.onload=void 0}),o=void 0,e()})});e.getImg=(()=>{return t}),e.getImgs=(()=>{return o}),e.getRealFrame=(()=>{return s})}}),SkyEngine.ParticleSystem=CLASS(()=>{let e=(e,n)=>{return Math.random()*(n-e)+e};return{preset:()=>{return SkyEngine.Node},init:(n,i,t)=>{let o,c,a=t.particleSrc,r=t.particleFigure,l=t.particleStartX,d=t.particleStartY,g=t.particleEndX,f=t.particleEndY,u=t.particleWidth,S=t.particleHeight,s=t.particlePoints,v=t.particleColor,h=t.particleBorder,R=t.particleColorR,p=t.minParticleColorR,E=t.maxParticleColorR,y=t.particleColorG,k=t.minParticleColorG,m=t.maxParticleColorG,C=t.particleColorB,w=t.minParticleColorB,x=t.maxParticleColorB,I=t.particleCenterX,Y=t.particleCenterY,X=t.particleCount,D=t.minParticleCount,T=t.maxParticleCount,A=t.particleX,P=t.minParticleX,O=t.maxParticleX,M=t.particleY,H=t.minParticleY,W=t.maxParticleY,F=t.particleLifetime,N=t.minParticleLifetime,L=t.maxParticleLifetime,V=t.particleDirection,_=t.minParticleDirection,b=t.maxParticleDirection,B=t.particleSpeed,U=t.minParticleSpeed,G=t.maxParticleSpeed,K=t.particleAccelX,q=t.particleAccelY,z=t.particleScale,Z=t.minParticleScale,J=t.maxParticleScale,j=t.particleScalingSpeed,Q=t.minParticleScalingSpeed,$=t.maxParticleScalingSpeed,ee=t.isParticleAngleToDirection,ne=t.particleAngle,ie=t.minParticleAngle,te=t.maxParticleAngle,oe=t.particleRotationSpeed,ce=t.minParticleRotationSpeed,ae=t.maxParticleRotationSpeed,re=t.particleAlpha,le=t.minParticleAlpha,de=t.maxParticleAlpha,ge=t.particleFadingSpeed,fe=t.minParticleFadingSpeed,ue=t.maxParticleFadingSpeed;void 0===R&&(R=0),void 0===p&&(p=R),void 0===E&&(E=R),void 0===y&&(y=0),void 0===k&&(k=y),void 0===m&&(m=y),void 0===C&&(C=0),void 0===w&&(w=C),void 0===x&&(x=C),void 0===I&&(I=0),void 0===Y&&(Y=0),void 0===X&&(X=1),void 0===D&&(D=X),void 0===T&&(T=X),void 0===A&&(A=0),void 0===P&&(P=A),void 0===O&&(O=A),void 0===M&&(M=0),void 0===H&&(H=M),void 0===W&&(W=M),void 0===N&&(N=F),void 0===L&&(L=F),void 0===_&&(_=V),void 0===b&&(b=V),void 0===U&&(U=B),void 0===G&&(G=B),void 0===K&&(K=0),void 0===q&&(q=0),void 0===z&&(z=1),void 0===Z&&(Z=z),void 0===J&&(J=z),void 0===j&&(j=0),void 0===Q&&(Q=j),void 0===$&&($=j),void 0===ne&&(ne=0),void 0===ie&&(ie=ne),void 0===te&&(te=ne),void 0===oe&&(oe=0),void 0===ce&&(ce=oe),o=ce*Math.PI/180,void 0===ae&&(ae=oe),c=ce*Math.PI/180,void 0===re&&(re=1),void 0===le&&(le=re),void 0===de&&(de=re),void 0===ge&&(ge=0),void 0===fe&&(fe=ge),void 0===ue&&(ue=ge);let Se,se,ve;if(void 0!==h){let e=h.split(" ");Se=INTEGER(e[0]),se=e[1],ve=e[2]}let he,Re,pe;void 0!==a?(pe=new Image,pe.onload=(()=>{he=pe.width,void 0===u&&(u=he),Re=pe.height,void 0===S&&(S=Re),pe.onload=void 0,i.fireEvent("load")}),pe.src=a):i.fireEvent("load");let Ee,ye,ke=[];i.burst=(n=>{Ee=n,REPEAT(e(D,T),()=>{let n=e(_,b)*Math.PI/180,i=Math.sin(n),t=Math.cos(n),a=e(U,G),l={time:0,lifetime:e(N,L),x:e(P,O),y:e(H,W),scalingSpeed:e(Q,$),direction:n,speedX:a*t,speedY:a*i,scale:e(Z,J),rotationSpeedRadian:e(o,c),radian:e(ie,te)*Math.PI/180,fadingSpeed:e(fe,ue),alpha:e(le,de)};void 0!==r&&void 0===v&&(l.color="rgb("+RANDOM({min:p,max:E})+", "+RANDOM({min:k,max:m})+", "+RANDOM({min:w,max:x})+")"),ke.push(l)})});OVERRIDE(i.step,e=>{ye=i.step=(n=>{for(let t=0;t<ke.length;t+=1){let e=ke[t];if(e.time+=n,e.time>e.lifetime?(ke.splice(t,1),void 0!==Ee&&0===ke.length&&Ee(i)):(e.speedX+=K*n,e.speedY+=q*n,e.x+=e.speedX*n,e.y+=e.speedY*n,e.scale+=e.scalingSpeed*n,e.scale<0&&(e.scale=0),e.radian+=e.rotationSpeedRadian*n,e.alpha+=e.fadingSpeed*n,e.alpha<0&&(e.alpha=0)),void 0===ke)break}e(n)})});let me;OVERRIDE(i.draw,e=>{me=i.draw=(n=>{for(let i=0;i<ke.length;i+=1){let e=ke[i],t=e.scale;if(n.save(),n.translate(e.x,e.y),ee===!0?n.rotate(e.direction):n.rotate(e.radian),n.scale(t,t),n.globalAlpha*=e.alpha,void 0===r)n.drawImage(pe,I-he/2,Y-Re/2,he,Re);else{if(n.beginPath(),"line"===r)n.moveTo(I+l,Y+d),n.lineTo(I+g,Y+f);else if("rect"===r)n.rect(I-u/2,I-S/2,u,S);else if("circle"===r)n.ellipse(I,Y,u/2,S/2,0,0,2*Math.PI);else if("polygon"===r&&s.length>0){n.moveTo(I+s[0].x,Y+s[0].y);for(let e=1;e<s.length;e+=1){let i=s[e];n.lineTo(I+i.x,Y+i.y)}n.lineTo(I+s[0].x,Y+s[0].y)}void 0!==v?(n.fillStyle=v,n.fill()):void 0!==e.color&&(n.fillStyle=e.color,n.fill()),void 0!==h&&(n.lineWidth=Se,n.strokeStyle=ve,"dashed"===se?n.setLineDash([5]):"dotted"===se&&n.setLineDash([2]),n.stroke()),n.closePath()}n.restore()}e(n)})});let Ce;OVERRIDE(i.remove,e=>{Ce=i.remove=(()=>{void 0!==pe&&(pe.onload=void 0,pe=void 0),ke=void 0,e()})})}}}),SkyEngine.ParticleSystemOnce=CLASS({preset:()=>{return SkyEngine.ParticleSystem},init:(e,n,i)=>{n.burst(e=>{e.remove()})}}),SkyEngine.CollisionTile=CLASS({preset:()=>{return SkyEngine.Tile}}),SkyEngine.HexagonTileMap=CLASS({preset:()=>{return SkyEngine.TileMap},init:(e,n,i)=>{let t,o=i.overlapHeight;OVERRIDE(n.addTile,i=>{t=n.addTile=(i=>{let t=i.row,c=i.col,a=e.createTile(i);void 0!==a&&(a.setPosition({x:c*n.getTileWidth()+t%2*n.getTileWidth()/2,y:t*(n.getTileHeight()-o)}),a.checkIsInstanceOf(SkyEngine.CollisionTile)===!0&&a.addCollider(SkyEngine.Polygon({points:[{x:0,y:-n.getTileHeight()/2},{x:n.getTileWidth()/2,y:-n.getTileHeight()/4},{x:n.getTileWidth()/2,y:n.getTileHeight()/4},{x:0,y:n.getTileHeight()/2},{x:-n.getTileWidth()/2,y:n.getTileHeight()/4},{x:-n.getTileWidth()/2,y:-n.getTileHeight()/4}]})))})});let c;OVERRIDE(n.moveTile,i=>{c=n.moveTile=((i,t)=>{let c=i.fromRow,a=i.fromCol,r=i.toRow,l=i.toCol,d=i.speed,g=i.accel,f=e.swapTile(i),u=f.fromTile,S=f.toTile;void 0!==u&&(void 0!==d||void 0!==g?(u.moveTo({x:l*n.getTileWidth()+r%2*n.getTileWidth()/2,y:r*(n.getTileHeight()-o),speed:d,accel:g},t),t=void 0):u.setPosition({x:l*n.getTileWidth()+r%2*n.getTileWidth()/2,y:r*(n.getTileHeight()-o)})),void 0!==S&&(void 0!==d||void 0!==g?(S.moveTo({x:a*n.getTileWidth()+c%2*n.getTileWidth()/2,y:c*(n.getTileHeight()-o),speed:d,accel:g},t),t=void 0):S.setPosition({x:a*n.getTileWidth()+c%2*n.getTileWidth()/2,y:c*(n.getTileHeight()-o)}))})});let a;OVERRIDE(n.findPath,e=>{a=n.findPath=(e=>{let i=e.startRow,t=e.startCol,o=e.endRow,c=e.endCol,a=[],r=[],l=(e,i,t)=>{if(void 0!==n.getTile({row:i,col:t})&&n.checkCollisionTile({row:i,col:t})!==!0){void 0===a[i]&&(a[i]=[]);let n=e.cost+1;(void 0===a[i][t]||a[i][t]>n)&&(a[i][t]=n,r.push({parent:e,row:i,col:t,cost:n}))}};for(l({cost:-1},i,t);r.length>0;){let e=r.shift();if(e.row===o&&e.col===c){let n=[],i=e;for(;i.cost>=0;)n.unshift({row:i.row,col:i.col}),i=i.parent;return n}e.row%2===0?(l(e,e.row-1,e.col-1),l(e,e.row-1,e.col),l(e,e.row,e.col+1),l(e,e.row+1,e.col),l(e,e.row+1,e.col-1),l(e,e.row,e.col-1)):(l(e,e.row-1,e.col),l(e,e.row-1,e.col+1),l(e,e.row,e.col+1),l(e,e.row+1,e.col+1),l(e,e.row+1,e.col),l(e,e.row,e.col-1))}})})}}),SkyEngine.IsometricTileMap=CLASS({preset:()=>{return SkyEngine.TileMap},init:(e,n,i)=>{let t;OVERRIDE(n.addTile,i=>{t=n.addTile=(i=>{let t=i.row,o=i.col,c=e.createTile(i);void 0!==c&&(c.setPosition({x:o*n.getTileWidth()+t%2*n.getTileWidth()/2,y:t*n.getTileHeight()/2}),c.checkIsInstanceOf(SkyEngine.CollisionTile)===!0&&c.addCollider(SkyEngine.Polygon({points:[{x:0,y:-n.getTileHeight()/2},{x:n.getTileWidth()/2,y:0},{x:0,y:n.getTileHeight()/2},{x:-n.getTileWidth()/2,y:0}]})))})});let o;OVERRIDE(n.moveTile,i=>{o=n.moveTile=((i,t)=>{let o=i.fromRow,c=i.fromCol,a=i.toRow,r=i.toCol,l=i.speed,d=i.accel,g=e.swapTile(i),f=g.fromTile,u=g.toTile;void 0!==f&&(void 0!==l||void 0!==d?(f.moveTo({x:r*n.getTileWidth()+a%2*n.getTileWidth()/2,y:a*n.getTileHeight()/2,speed:l,accel:d},t),t=void 0):f.setPosition({x:r*n.getTileWidth()+a%2*n.getTileWidth()/2,y:a*n.getTileHeight()/2})),void 0!==u&&(void 0!==l||void 0!==d?(u.moveTo({x:c*n.getTileWidth()+o%2*n.getTileWidth()/2,y:o*n.getTileHeight()/2,speed:l,accel:d},t),t=void 0):u.setPosition({x:c*n.getTileWidth()+o%2*n.getTileWidth()/2,y:o*n.getTileHeight()/2}))})});let c;OVERRIDE(n.findPath,e=>{c=n.findPath=(e=>{let i=e.startRow,t=e.startCol,o=e.endRow,c=e.endCol,a=[],r=[],l=(e,i,t)=>{if(void 0!==n.getTile({row:i,col:t})&&n.checkCollisionTile({row:i,col:t})!==!0){void 0===a[i]&&(a[i]=[]);let n=e.cost+1;(void 0===a[i][t]||a[i][t]>n)&&(a[i][t]=n,r.push({parent:e,row:i,col:t,cost:n}))}};for(l({cost:-1},i,t);r.length>0;){let e=r.shift();if(e.row===o&&e.col===c){let n=[],i=e;for(;i.cost>=0;)n.unshift({row:i.row,col:i.col}),i=i.parent;return n}e.row%2===0?(l(e,e.row-1,e.col-1),l(e,e.row-1,e.col),l(e,e.row+1,e.col-1),l(e,e.row+1,e.col)):(l(e,e.row-1,e.col),l(e,e.row-1,e.col+1),l(e,e.row+1,e.col),l(e,e.row+1,e.col+1))}})})}}),SkyEngine.Tile=CLASS({preset:()=>{return SkyEngine.Node}}),SkyEngine.TileMap=CLASS({preset:()=>{return SkyEngine.Node},init:(e,n,i)=>{let t=i.tileWidth,o=i.tileHeight,c=i.tileSet,a=i.tileKeyMap;void 0===c&&(c={}),void 0===a&&(a=[]);let r,l=[],d=(n.getTileWidth=(()=>{return t}),n.getTileHeight=(()=>{return o}),e.createTile=(e=>{let i=e.row,t=e.col,o=e.tile,r=e.key;return void 0!==r&&void 0!==c[r]&&(o=c[r](i,t),void 0===a[i]&&(a[i]=[]),a[i][t]=r),void 0!==o&&(n.append(o),void 0===l[i]&&(l[i]=[]),l[i][t]=o),o})),g=(n.addTile=(e=>{let n=e.row,i=e.col,c=d(e);void 0!==c&&(c.setPosition({x:i*t,y:n*o}),c.checkIsInstanceOf(SkyEngine.CollisionTile)===!0&&c.addCollider(SkyEngine.Rect({width:t,height:o})))}),n.getTileKey=(e=>{let n=e.row,i=e.col;if(void 0!==a&&void 0!==a[n])return a[n][i]}),n.getTile=(e=>{let n=e.row,i=e.col;if(void 0!==l[n])return l[n][i]})),f=e.swapTile=(e=>{let n,i=e.fromRow,t=e.fromCol,o=e.toRow,c=e.toCol;void 0===a[o]?a[o]=[]:n=a[o][c],void 0===a[i]?a[i]=[]:a[o][c]=a[i][t],a[i][t]=n;let r;void 0!==l[i]&&(r=l[i][t]);let d;return void 0!==l[o]&&(d=l[o][c]),void 0===l[o]&&(l[o]=[]),l[o][c]=r,void 0===d?void 0!==l[i]&&(l[i][t]=void 0):(void 0===l[i]&&(l[i]=[]),l[i][t]=d),{fromTile:r,toTile:d}});n.moveTile=((e,n)=>{let i=e.fromRow,c=e.fromCol,a=e.toRow,r=e.toCol,l=e.speed,d=e.accel,g=f(e),u=g.fromTile,S=g.toTile;void 0!==u&&(void 0!==l||void 0!==d?(u.moveTo({x:r*t,y:a*o,speed:l,accel:d},n),n=void 0):u.setPosition({x:r*t,y:a*o})),void 0!==S&&(void 0!==l||void 0!==d?(S.moveTo({x:c*t,y:i*o,speed:l,accel:d},n),n=void 0):S.setPosition({x:c*t,y:i*o}))}),n.removeTile=(e=>{let n=e.row,i=e.col;void 0!==a[n]&&(a[n][i]=void 0),void 0!==l[n]&&void 0!==l[n][i]&&(l[n][i].remove(),l[n][i]=void 0)});OVERRIDE(n.empty,e=>{r=n.empty=(()=>{a=[],l=[],e()})});let u=n.checkCollisionTile=(e=>{let n=e.row,i=e.col;return void 0!==l[n]&&void 0!==l[n][i]&&l[n][i].checkIsInstanceOf(SkyEngine.CollisionTile)===!0});n.findPath=(e=>{let n=e.startRow,i=e.startCol,t=e.endRow,o=e.endCol,c=[],a=[],r=(e,n,i)=>{if(void 0!==g({row:n,col:i})&&u({row:n,col:i})!==!0){void 0===c[n]&&(c[n]=[]);let t=e.cost+1;(void 0===c[n][i]||c[n][i]>t)&&(c[n][i]=t,a.push({parent:e,row:n,col:i,cost:t}))}};for(r({cost:-1},n,i);a.length>0;){let e=a.shift();if(e.row===t&&e.col===o){let n=[],i=e;for(;i.cost>=0;)n.unshift({row:i.row,col:i.col}),i=i.parent;return n}r(e,e.row-1,e.col),r(e,e.row,e.col+1),r(e,e.row+1,e.col),r(e,e.row,e.col-1)}})},afterInit:(e,n,i)=>{let t=i.tileMap,o=i.tileKeyMap;void 0!==t&&(EACH(t,(e,i)=>{EACH(e,(e,t)=>{void 0!==e&&n.addTile({row:i,col:t,tile:e})})}),t=void 0),void 0!==o&&EACH(o,(e,i)=>{EACH(e,(e,t)=>{n.addTile({row:i,col:t,key:e})})})}}),SkyEngine("Util").Collision=OBJECT({init:(e,n)=>{let i=(e,n,i)=>{return(n-e)*(i-e)<=0},t=n.checkPointInRect=((e,n,t,o,c,a,r,l,d,g)=>{e-=t,n-=o;let f=t+g*e+d*n,u=o-d*e+g*n;return c*=r,a*=l,t-=c/2,o-=a/2,i(f,t,t+c)===!0&&i(u,o,o+a)===!0}),o=n.checkPointInCircle=((e,n,i,t,o,c,a,r,l,d)=>{e-=i,n-=t,o*=a,c*=r;let g=2*(d*e+l*n)/o,f=2*(l*e-d*n)/c;return g*g+f*f<=1}),c=n.checkPointInPolygon=((e,n,i,t,o,c,a,r,l)=>{e-=i,n-=t;let d=i+l*e+r*n,g=t-r*e+l*n;d-=i,g-=t;let f=!1,u=o.length;for(let S=0,s=u-1;S<u;s=S,S+=1){let e=o[S].x*c,n=o[S].y*a,i=o[s].x*c,t=o[s].y*a;n>g!=t>g&&d<(i-e)*(g-n)/(t-n)+e&&(f=!f)}return f}),a=n.checkLineLine=((e,n,i,t,o,c,a,r,l,d,g,f,u,S,s,v,h,R,p,E)=>{i*=a,t*=r;let y=e+d*i+l*t,k=n+l*i+d*t;o*=a,c*=r;let m=e+d*o+l*c,C=n+l*o+d*c;u*=h,S*=R;let w=g+E*u+p*S,x=f+p*u+E*S;s*=h,v*=R;let I=g+E*s+p*v,Y=f+p*s+E*v,X=(m-y)*(Y-x)-(I-w)*(C-k);if(0===X)return!1;{let e=((Y-x)*(I-y)+(w-I)*(Y-k))/X,n=((k-C)*(I-y)+(m-y)*(Y-k))/X;return 0<=e&&e<=1&&0<=n&&n<=1}}),r=(n.checkLineRect=((e,n,i,o,c,r,l,d,g,f,u,S,s,v,h,R,p,E)=>{i*=l,o*=d;let y=e+f*i+g*o,k=n+g*i+f*o;if(t(y,k,u,S,s,v,h,R,p,E)===!0)return!0;c*=l,r*=d;let m=e+f*c+g*r,C=n+g*c+f*r;if(t(m,C,u,S,s,v,h,R,p,E)===!0)return!0;let w,x,I,Y,X,D,T,A;s*=h/2,v*=R/2;let P=E*s,O=E*v,M=-p*s,H=-p*v;return w=u-P-H,x=S+M-O,I=u+P-H,Y=S-M-O,X=u+P+H,D=S-M+O,T=u-P+H,A=S+M+O,a(0,0,y,k,m,C,1,1,0,1,0,0,w,x,I,Y,1,1,0,1)===!0||a(0,0,y,k,m,C,1,1,0,1,0,0,I,Y,X,D,1,1,0,1)===!0||a(0,0,y,k,m,C,1,1,0,1,0,0,X,D,T,A,1,1,0,1)===!0||a(0,0,y,k,m,C,1,1,0,1,0,0,T,A,w,x,1,1,0,1)===!0}),n.checkLineCircle=((e,n,t,c,a,l,d,g,f,u,S,s,v,h,R,p,E,y)=>{t*=d,c*=g;let k=e+u*t+f*c,m=n+f*t+u*c;if(o(k,m,S,s,v,h,R,p,E,y)===!0)return!0;a*=d,l*=g;let C=e+u*a+f*l,w=n+f*a+u*l;if(o(C,w,S,s,v,h,R,p,E,y)===!0)return!0;k-=S,m-=s,C-=S,w-=s;let x=y*k+E*m,I=-E*k+y*m,Y=y*C+E*w,X=-E*C+y*w;v*=R,h*=p;let D=(X-I)/(Y-x);if(Math.abs(D)>1024)return r(0,0,I,x,X,Y,1,1,0,1,0,0,h,v,1,1,0,1);if(o(Y,X,0,0,v,h,1,1,0,1)===!0)return!0;let T=v*v/4,A=h*h/4,P=I-D*x,O=1/T+D*D/A,M=2*D*P/A,H=P*P/A-1,W=M*M-4*O*H;return!(W<0)&&(W=Math.sqrt(W),O*=2,i((-M-W)/O,x,Y)===!0||i((-M+W)/O,x,Y)===!0)})),l=(n.checkLinePolygon=((e,n,i,t,o,r,l,d,g,f,u,S,s,v,h,R,p)=>{i*=l,t*=d;let E=e+f*i+g*t,y=n+g*i+f*t;if(c(E,y,u,S,s,v,h,R,p)===!0)return!0;o*=l,r*=d;let k=e+f*o+g*r,m=n+g*o+f*r;if(c(k,m,u,S,s,v,h,R,p)===!0)return!0;let C=s.length;for(let w=0,x=C-1;w<C;x=w,w+=1){let e=s[w].x*v,n=s[w].y*h,i=s[x].x*v,t=s[x].y*h,o=u+p*e-R*n,c=S+R*e+p*n,r=u+p*i-R*t,l=S+R*i+p*t;if(a(0,0,E,y,k,m,1,1,0,1,0,0,o,c,r,l,1,1,0,1)===!0)return!0}return!1}),n.checkRectRect=((e,n,i,o,c,r,l,d,g,f,u,S,s,v,h,R)=>{i*=c,o*=r,u*=s,S*=v;let p,E,y,k,m,C,w,x,I=d*i/2,Y=d*o/2,X=-l*i/2,D=-l*o/2;if(p=e-I-D,E=n+X-Y,y=e+I-D,k=n-X-Y,m=e+I+D,C=n-X+Y,w=e-I+D,x=n+X+Y,t(p,E,g,f,u,S,1,1,h,R)===!0||t(y,k,g,f,u,S,1,1,h,R)===!0||t(m,C,g,f,u,S,1,1,h,R)===!0||t(w,x,g,f,u,S,1,1,h,R)===!0)return!0;let T,A,P,O,M,H,W,F,N=R*u/2,L=R*S/2,V=-h*u/2,_=-h*S/2;return T=g-N-_,A=f+V-L,P=g+N-_,O=f-V-L,M=g+N+_,H=f-V+L,W=g-N+_,F=f+V+L,t(T,A,e,n,i,o,1,1,l,d)===!0||t(P,O,e,n,i,o,1,1,l,d)===!0||t(M,H,e,n,i,o,1,1,l,d)===!0||t(W,F,e,n,i,o,1,1,l,d)===!0||(a(0,0,p,E,y,k,1,1,0,1,0,0,T,A,P,O,1,1,0,1)===!0||a(0,0,p,E,y,k,1,1,0,1,0,0,P,O,M,H,1,1,0,1)===!0||a(0,0,p,E,y,k,1,1,0,1,0,0,M,H,W,F,1,1,0,1)===!0||a(0,0,p,E,y,k,1,1,0,1,0,0,W,F,T,A,1,1,0,1)===!0||a(0,0,y,k,m,C,1,1,0,1,0,0,T,A,P,O,1,1,0,1)===!0||a(0,0,y,k,m,C,1,1,0,1,0,0,P,O,M,H,1,1,0,1)===!0||a(0,0,y,k,m,C,1,1,0,1,0,0,M,H,W,F,1,1,0,1)===!0||a(0,0,y,k,m,C,1,1,0,1,0,0,W,F,T,A,1,1,0,1)===!0||a(0,0,m,C,w,x,1,1,0,1,0,0,T,A,P,O,1,1,0,1)===!0||a(0,0,m,C,w,x,1,1,0,1,0,0,P,O,M,H,1,1,0,1)===!0||a(0,0,m,C,w,x,1,1,0,1,0,0,M,H,W,F,1,1,0,1)===!0||a(0,0,m,C,w,x,1,1,0,1,0,0,W,F,T,A,1,1,0,1)===!0||a(0,0,w,x,p,E,1,1,0,1,0,0,T,A,P,O,1,1,0,1)===!0||a(0,0,w,x,p,E,1,1,0,1,0,0,P,O,M,H,1,1,0,1)===!0||a(0,0,w,x,p,E,1,1,0,1,0,0,M,H,W,F,1,1,0,1)===!0||a(0,0,w,x,p,E,1,1,0,1,0,0,W,F,T,A,1,1,0,1)===!0)}),n.checkRectCircle=((e,n,i,c,a,l,d,g,f,u,S,s,v,h,R,p)=>{if(t(f,u,e,n,i,c,a,l,d,g)===!0)return!0;let E,y,k,m,C,w,x,I;i*=a/2,c*=l/2;let Y=g*i,X=g*c,D=-d*i,T=-d*c;return E=e-Y-T,y=n+D-X,k=e+Y-T,m=n-D-X,C=e+Y+T,w=n-D+X,x=e-Y+T,I=n+D+X,o(E,y,f,u,S,s,v,h,R,p)===!0||o(k,m,f,u,S,s,v,h,R,p)===!0||o(C,w,f,u,S,s,v,h,R,p)===!0||o(x,I,f,u,S,s,v,h,R,p)===!0||(S*=v,s*=h,r(0,0,E,y,k,m,1,1,0,1,f,u,S,s,1,1,R,p)===!0||r(0,0,k,m,C,w,1,1,0,1,f,u,S,s,1,1,R,p)===!0||r(0,0,C,w,x,I,1,1,0,1,f,u,S,s,1,1,R,p)===!0||r(0,0,x,I,E,y,1,1,0,1,f,u,S,s,1,1,R,p)===!0)}),n.checkRectPolygon=((e,n,i,o,r,l,d,g,f,u,S,s,v,h,R)=>{i*=r,o*=l;let p,E,y,k,m,C,w,x,I=g*i/2,Y=g*o/2,X=-d*i/2,D=-d*o/2;if(p=e-I-D,E=n+X-Y,y=e+I-D,k=n-X-Y,m=e+I+D,C=n-X+Y,w=e-I+D,x=n+X+Y,c(p,E,f,u,S,s,v,h,R)===!0||c(y,k,f,u,S,s,v,h,R)===!0||c(m,C,f,u,S,s,v,h,R)===!0||c(w,x,f,u,S,s,v,h,R)===!0)return!0;let T=S.length;for(let A=0,P=T-1;A<T;P=A,A+=1){let c=S[A].x*s,r=S[A].y*v,l=f+R*c-h*r,I=u+h*c+R*r;if(t(l,I,e,n,i,o,1,1,d,g)===!0)return!0;let Y=S[P].x*s,X=S[P].y*v,D=f+R*Y-h*X,T=u+h*Y+R*X;if(a(0,0,p,E,y,k,1,1,0,1,0,0,l,I,D,T,1,1,0,1)===!0||a(0,0,y,k,m,C,1,1,0,1,0,0,l,I,D,T,1,1,0,1)===!0||a(0,0,m,C,w,x,1,1,0,1,0,0,l,I,D,T,1,1,0,1)===!0||a(0,0,w,x,p,E,1,1,0,1,0,0,l,I,D,T,1,1,0,1)===!0)return!0}return!1}),(e,n,i,t,o)=>{if(0===o)return!0;if(0===e)return 0!==n||(0!==i?t*t-4*i*o>=0:0!==t);let c=n/e,a=i/e,r=t/e,l=o/e,d=(8*a-3*c*c)/8,g=(c*c*c-4*c*a+8*r)/8,f=(-3*c*c*c*c+256*l-64*r*c+16*c*c*a)/256,u=256*f*f*f-128*d*d*f*f+144*d*g*g*f-27*g*g*g*g+16*d*d*d*d*f-4*d*d*d*g*g,S=8*d,s=64*f-16*d*d;return u<0||u>0&&S<0&&s<0||0===u&&(0!==s||S<=0)}),d=(e,n,i,t,o,c,a,r,d,g,f,u)=>{let S=(r/=a)-(n/=e),s=(d/=a)-(i/=e),v=(g/=a)-(t/=e),h=(f/=a)-(o/=e),R=(u/=a)-(c/=e);
if(0===S&&0===v)return l(0,0,s,h,R);let p=n*d-r*i,E=n*f+t*d-r*o-g*i,y=n*u+t*f-r*c-g*o,k=t*u-g*c,m=s*s-p*S,C=2*s*h-S*E-v*p,w=h*h+2*s*R-S*y-v*E,x=2*h*R-v*y-S*k,I=R*R-v*k;return l(m,C,w,x,I)};n.checkCircleCircle=((e,n,i,t,c,a,r,l,g,f,u,S,s,v,h,R)=>{i*=c,t*=a,u*=s,S*=v,g-=e,f-=n,e=n=0;let p=((i>t?i:t)+(u>S?u:S))/2;if(g*g+f*f>p*p)return!1;if(o(g,f,e,n,i,t,1,1,r,l)===!0||o(e,n,g,f,u,S,1,1,h,R)===!0)return!0;let E=l*e+r*n,y=-r*e+l*n;r=-r;let k=i*i/4,m=t*t/4,C=l*l/k+r*r/m,w=-2*l*r/k+2*l*r/m,x=r*r/k+l*l/m,I=-2*E*l/k-2*y*r/m,Y=2*E*r/k-2*y*l/m,X=E*E/k+y*y/m-1;E=R*g+h*f,y=-h*g+R*f,h=-h,k=u*u/4,m=S*S/4;let D=R*R/k+h*h/m,T=-2*R*h/k+2*R*h/m,A=h*h/k+R*R/m,P=-2*E*R/k-2*y*h/m,O=2*E*h/k-2*y*R/m,M=E*E/k+y*y/m-1;return d(C,w,x,I,Y,X,D,T,A,P,O,M)&&d(x,w,C,Y,I,X,A,T,D,O,P,M)}),n.checkCirclePolygon=((e,n,i,t,a,l,d,g,f,u,S,s,v,h,R)=>{if(c(e,n,f,u,S,s,v,h,R)===!0)return!0;i*=a,t*=l;let p=S.length;for(let E=0,y=p-1;E<p;y=E,E+=1){let c=S[E].x*s,a=S[E].y*v,l=f+R*c-h*a,p=u+h*c+R*a;if(o(l,p,e,n,i,t,1,1,d,g)===!0)return!0;let k=S[y].x*s,m=S[y].y*v,C=f+R*k-h*m,w=u+h*k+R*m;if(r(0,0,l,p,C,w,1,1,0,1,e,n,i,t,1,1,d,g)===!0)return!0}return!1}),n.checkPolygonPolygon=((e,n,i,t,o,r,l,d,g,f,u,S,s,v)=>{let h=i.length,R=f.length;for(let p=0,E=R-1;p<R;E=p,p+=1){let a=f[p].x*u,h=f[p].y*S,R=d+v*a-s*h,E=g+s*a+v*h;if(c(R,E,e,n,i,t,o,r,l)===!0)return!0}for(let p=0,E=h-1;p<h;E=p,p+=1){let h=i[p].x*t,y=i[p].y*o,k=e+l*h-r*y,m=n+r*h+l*y;if(c(k,m,d,g,f,u,S,s,v)===!0)return!0;let C=i[E].x*t,w=i[E].y*o,x=e+l*C-r*w,I=n+r*C+l*w;for(let Y=0,X=R-1;Y<R;X=Y,Y+=1){let e=f[Y].x*u,n=f[Y].y*S,i=d+v*e-s*n,t=g+s*e+v*n,o=f[X].x*u,c=f[X].y*S,r=d+v*o-s*c,l=g+s*o+v*c;if(a(0,0,k,m,x,I,1,1,0,1,0,0,i,t,r,l,1,1,0,1)===!0)return!0}}return!1})}}),SkyEngine("Util").ImageData=OBJECT({init:(e,n)=>{const i=[1,0,1,1,-1,0,-1,1,0,0,0,0,-1,0,-1],t=[0,-1,0,0,0,-1,0,0,1,-1,1,1,0,-1,0];let o=n.checkImageDataPointIsTransparent=((e,n,i,t)=>{return e[4*(t*n+i)+3]<=20});n.convertImageDataToPolygonPoints=((e,n)=>{let c,a,r,l,d=0,g=0,f=[];for(;;){if(o(e,n,d,g)!==!0){r=d,l=g;break}0===d?(d=g+1,g=0):(d-=1,g+=1)}d=r,g=l;let u=0,S=0;do{let r=0;if(o(e,n,d-1,g-1)!==!0&&(r+=1),o(e,n,d,g-1)!==!0&&(r+=2),o(e,n,d-1,g)!==!0&&(r+=4),o(e,n,d,g)!==!0&&(r+=8),6===r)u=a===-1?-1:1,S=0;else if(9===r)u=0,S=1===c?-1:1;else{if(!(r<15))break;u=i[r],S=t[r]}if(u!==c&&S!==a&&(f.push({x:d,y:g}),c=u,a=S),d+=u,g+=S,d<0||g<0)break}while(r!==d||l!==g);return f})}});